"use strict";var Hc=Object.create;var Hr=Object.defineProperty;var Gc=Object.getOwnPropertyDescriptor;var Yc=Object.getOwnPropertyNames;var Qc=Object.getPrototypeOf,Jc=Object.prototype.hasOwnProperty;var $=(n,t)=>()=>(n&&(t=n(n=0)),t);var N=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),pi=(n,t)=>{for(var r in t)Hr(n,r,{get:t[r],enumerable:!0})},Po=(n,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Yc(t))!Jc.call(n,o)&&o!==r&&Hr(n,o,{get:()=>t[o],enumerable:!(s=Gc(t,o))||s.enumerable});return n};var V=(n,t,r)=>(r=n!=null?Hc(Qc(n)):{},Po(t||!n||!n.__esModule?Hr(r,"default",{value:n,enumerable:!0}):r,n)),Kc=n=>Po(Hr({},"__esModule",{value:!0}),n);var Uo=N((fh,qo)=>{"use strict";var{Duplex:Xc}=require("stream");function Io(n){n.emit("close")}function Zc(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Do(n){this.removeListener("error",Do),this.destroy(),this.listenerCount("error")===0&&this.emit("error",n)}function ef(n,t){let r=!0,s=new Xc({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return n.on("message",function(l,c){let _=!c&&s._readableState.objectMode?l.toString():l;s.push(_)||n.pause()}),n.once("error",function(l){s.destroyed||(r=!1,s.destroy(l))}),n.once("close",function(){s.destroyed||s.push(null)}),s._destroy=function(o,l){if(n.readyState===n.CLOSED){l(o),process.nextTick(Io,s);return}let c=!1;n.once("error",function(p){c=!0,l(p)}),n.once("close",function(){c||l(o),process.nextTick(Io,s)}),r&&n.terminate()},s._final=function(o){if(n.readyState===n.CONNECTING){n.once("open",function(){s._final(o)});return}n._socket!==null&&(n._socket._writableState.finished?(o(),s._readableState.endEmitted&&s.destroy()):(n._socket.once("finish",function(){o()}),n.close()))},s._read=function(){n.isPaused&&n.resume()},s._write=function(o,l,c){if(n.readyState===n.CONNECTING){n.once("open",function(){s._write(o,l,c)});return}n.send(o,c)},s.on("end",Zc),s.on("error",Do),s}qo.exports=ef});var Ye=N((dh,Fo)=>{"use strict";Fo.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var ta=N((hh,ea)=>{var jo=require("fs"),Be=require("path"),zo=require("os"),Vo=typeof __webpack_require__=="function"?__non_webpack_require__:require,tf=process.config&&process.config.variables||{},rf=!!process.env.PREBUILDS_ONLY,No=process.versions.modules,_i=of()?"electron":sf()?"node-webkit":"node",yi=process.env.npm_config_arch||zo.arch(),gi=process.env.npm_config_platform||zo.platform(),Ho=process.env.LIBC||(af(gi)?"musl":"glibc"),Si=process.env.ARM_VERSION||(yi==="arm64"?"8":tf.arm_version)||"",Go=(process.versions.uv||"").split(".")[0];ea.exports=ge;function ge(n){return Vo(ge.resolve(n))}ge.resolve=ge.path=function(n){n=Be.resolve(n||".");try{var t=Vo(Be.join(n,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[t+"_PREBUILD"]&&(n=process.env[t+"_PREBUILD"])}catch{}if(!rf){var r=Mo(Be.join(n,"build/Release"),$o);if(r)return r;var s=Mo(Be.join(n,"build/Debug"),$o);if(s)return s}var o=_(n);if(o)return o;var l=_(Be.dirname(process.execPath));if(l)return l;var c=["platform="+gi,"arch="+yi,"runtime="+_i,"abi="+No,"uv="+Go,Si?"armv="+Si:"","libc="+Ho,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+c+`
    loaded from: `+n+`
`);function _(p){var d=wi(Be.join(p,"prebuilds")).map(Yo),h=d.filter(Qo(gi,yi)).sort(Jo)[0];if(h){var g=Be.join(p,"prebuilds",h.name),v=wi(g).map(Ko),P=v.filter(Xo(_i,No)),y=P.sort(Zo(_i))[0];if(y)return Be.join(g,y.file)}}};function wi(n){try{return jo.readdirSync(n)}catch{return[]}}function Mo(n,t){var r=wi(n).filter(t);return r[0]&&Be.join(n,r[0])}function $o(n){return/\.node$/.test(n)}function Yo(n){var t=n.split("-");if(t.length===2){var r=t[0],s=t[1].split("+");if(r&&s.length&&s.every(Boolean))return{name:n,platform:r,architectures:s}}}function Qo(n,t){return function(r){return r==null||r.platform!==n?!1:r.architectures.includes(t)}}function Jo(n,t){return n.architectures.length-t.architectures.length}function Ko(n){var t=n.split("."),r=t.pop(),s={file:n,specificity:0};if(r==="node"){for(var o=0;o<t.length;o++){var l=t[o];if(l==="node"||l==="electron"||l==="node-webkit")s.runtime=l;else if(l==="napi")s.napi=!0;else if(l.slice(0,3)==="abi")s.abi=l.slice(3);else if(l.slice(0,2)==="uv")s.uv=l.slice(2);else if(l.slice(0,4)==="armv")s.armv=l.slice(4);else if(l==="glibc"||l==="musl")s.libc=l;else continue;s.specificity++}return s}}function Xo(n,t){return function(r){return!(r==null||r.runtime&&r.runtime!==n&&!nf(r)||r.abi&&r.abi!==t&&!r.napi||r.uv&&r.uv!==Go||r.armv&&r.armv!==Si||r.libc&&r.libc!==Ho)}}function nf(n){return n.runtime==="node"&&n.napi}function Zo(n){return function(t,r){return t.runtime!==r.runtime?t.runtime===n?-1:1:t.abi!==r.abi?t.abi?-1:1:t.specificity!==r.specificity?t.specificity>r.specificity?-1:1:0}}function sf(){return!!(process.versions&&process.versions.nw)}function of(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function af(n){return n==="linux"&&jo.existsSync("/etc/alpine-release")}ge.parseTags=Ko;ge.matchTags=Xo;ge.compareTags=Zo;ge.parseTuple=Yo;ge.matchTuple=Qo;ge.compareTuples=Jo});var Ri=N((ph,Ei)=>{var vi=typeof __webpack_require__=="function"?__non_webpack_require__:require;typeof vi.addon=="function"?Ei.exports=vi.addon.bind(vi):Ei.exports=ta()});var na=N((mh,ra)=>{"use strict";var lf=(n,t,r,s,o)=>{for(var l=0;l<o;l++)r[s+l]=n[l]^t[l&3]},uf=(n,t)=>{let r=n.length;for(var s=0;s<r;s++)n[s]^=t[s&3]};ra.exports={mask:lf,unmask:uf}});var ia=N((bh,Ti)=>{"use strict";try{Ti.exports=Ri()(__dirname)}catch{Ti.exports=na()}});var Gt=N((_h,Jr)=>{"use strict";var{EMPTY_BUFFER:cf}=Ye(),Ci=Buffer[Symbol.species];function ff(n,t){if(n.length===0)return cf;if(n.length===1)return n[0];let r=Buffer.allocUnsafe(t),s=0;for(let o=0;o<n.length;o++){let l=n[o];r.set(l,s),s+=l.length}return s<t?new Ci(r.buffer,r.byteOffset,s):r}function sa(n,t,r,s,o){for(let l=0;l<o;l++)r[s+l]=n[l]^t[l&3]}function oa(n,t){for(let r=0;r<n.length;r++)n[r]^=t[r&3]}function df(n){return n.length===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.length)}function xi(n){if(xi.readOnly=!0,Buffer.isBuffer(n))return n;let t;return n instanceof ArrayBuffer?t=new Ci(n):ArrayBuffer.isView(n)?t=new Ci(n.buffer,n.byteOffset,n.byteLength):(t=Buffer.from(n),xi.readOnly=!1),t}Jr.exports={concat:ff,mask:sa,toArrayBuffer:df,toBuffer:xi,unmask:oa};if(!process.env.WS_NO_BUFFER_UTIL)try{let n=ia();Jr.exports.mask=function(t,r,s,o,l){l<48?sa(t,r,s,o,l):n.mask(t,r,s,o,l)},Jr.exports.unmask=function(t,r){t.length<32?oa(t,r):n.unmask(t,r)}}catch{}});var ua=N((yh,la)=>{"use strict";var aa=Symbol("kDone"),ki=Symbol("kRun"),Pi=class{constructor(t){this[aa]=()=>{this.pending--,this[ki]()},this.concurrency=t||1/0,this.jobs=[],this.pending=0}add(t){this.jobs.push(t),this[ki]()}[ki](){if(this.pending!==this.concurrency&&this.jobs.length){let t=this.jobs.shift();this.pending++,t(this[aa])}}};la.exports=Pi});var Jt=N((gh,ha)=>{"use strict";var Yt=require("zlib"),ca=Gt(),hf=ua(),{kStatusCode:fa}=Ye(),pf=Buffer[Symbol.species],mf=Buffer.from([0,0,255,255]),Zr=Symbol("permessage-deflate"),We=Symbol("total-length"),Qt=Symbol("callback"),Qe=Symbol("buffers"),Xr=Symbol("error"),Kr,Ai=class{constructor(t,r,s){if(this._maxPayload=s|0,this._options=t||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Kr){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Kr=new hf(o)}}static get extensionName(){return"permessage-deflate"}offer(){let t={};return this._options.serverNoContextTakeover&&(t.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(t.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(t.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?t.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(t.client_max_window_bits=!0),t}accept(t){return t=this.normalizeParams(t),this.params=this._isServer?this.acceptAsServer(t):this.acceptAsClient(t),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let t=this._deflate[Qt];this._deflate.close(),this._deflate=null,t&&t(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(t){let r=this._options,s=t.find(o=>!(r.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>o.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(s.server_no_context_takeover=!0),r.clientNoContextTakeover&&(s.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(s.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?s.client_max_window_bits=r.clientMaxWindowBits:(s.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete s.client_max_window_bits,s}acceptAsClient(t){let r=t[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(t){return t.forEach(r=>{Object.keys(r).forEach(s=>{let o=r[s];if(o.length>1)throw new Error(`Parameter "${s}" must have only a single value`);if(o=o[0],s==="client_max_window_bits"){if(o!==!0){let l=+o;if(!Number.isInteger(l)||l<8||l>15)throw new TypeError(`Invalid value for parameter "${s}": ${o}`);o=l}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${s}": ${o}`)}else if(s==="server_max_window_bits"){let l=+o;if(!Number.isInteger(l)||l<8||l>15)throw new TypeError(`Invalid value for parameter "${s}": ${o}`);o=l}else if(s==="client_no_context_takeover"||s==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${s}": ${o}`)}else throw new Error(`Unknown parameter "${s}"`);r[s]=o})}),t}decompress(t,r,s){Kr.add(o=>{this._decompress(t,r,(l,c)=>{o(),s(l,c)})})}compress(t,r,s){Kr.add(o=>{this._compress(t,r,(l,c)=>{o(),s(l,c)})})}_decompress(t,r,s){let o=this._isServer?"client":"server";if(!this._inflate){let l=`${o}_max_window_bits`,c=typeof this.params[l]!="number"?Yt.Z_DEFAULT_WINDOWBITS:this.params[l];this._inflate=Yt.createInflateRaw({...this._options.zlibInflateOptions,windowBits:c}),this._inflate[Zr]=this,this._inflate[We]=0,this._inflate[Qe]=[],this._inflate.on("error",_f),this._inflate.on("data",da)}this._inflate[Qt]=s,this._inflate.write(t),r&&this._inflate.write(mf),this._inflate.flush(()=>{let l=this._inflate[Xr];if(l){this._inflate.close(),this._inflate=null,s(l);return}let c=ca.concat(this._inflate[Qe],this._inflate[We]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[We]=0,this._inflate[Qe]=[],r&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),s(null,c)})}_compress(t,r,s){let o=this._isServer?"server":"client";if(!this._deflate){let l=`${o}_max_window_bits`,c=typeof this.params[l]!="number"?Yt.Z_DEFAULT_WINDOWBITS:this.params[l];this._deflate=Yt.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:c}),this._deflate[We]=0,this._deflate[Qe]=[],this._deflate.on("data",bf)}this._deflate[Qt]=s,this._deflate.write(t),this._deflate.flush(Yt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let l=ca.concat(this._deflate[Qe],this._deflate[We]);r&&(l=new pf(l.buffer,l.byteOffset,l.length-4)),this._deflate[Qt]=null,this._deflate[We]=0,this._deflate[Qe]=[],r&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),s(null,l)})}};ha.exports=Ai;function bf(n){this[Qe].push(n),this[We]+=n.length}function da(n){if(this[We]+=n.length,this[Zr]._maxPayload<1||this[We]<=this[Zr]._maxPayload){this[Qe].push(n);return}this[Xr]=new RangeError("Max payload size exceeded"),this[Xr].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Xr][fa]=1009,this.removeListener("data",da),this.reset()}function _f(n){this[Zr]._inflate=null,n[fa]=1007,this[Qt](n)}});var ma=N((Sh,pa)=>{"use strict";function yf(n){let t=n.length,r=0;for(;r<t;)if(!(n[r]&128))r++;else if((n[r]&224)===192){if(r+1===t||(n[r+1]&192)!==128||(n[r]&254)===192)return!1;r+=2}else if((n[r]&240)===224){if(r+2>=t||(n[r+1]&192)!==128||(n[r+2]&192)!==128||n[r]===224&&(n[r+1]&224)===128||n[r]===237&&(n[r+1]&224)===160)return!1;r+=3}else if((n[r]&248)===240){if(r+3>=t||(n[r+1]&192)!==128||(n[r+2]&192)!==128||(n[r+3]&192)!==128||n[r]===240&&(n[r+1]&240)===128||n[r]===244&&n[r+1]>143||n[r]>244)return!1;r+=4}else return!1;return!0}pa.exports=yf});var ba=N((wh,Oi)=>{"use strict";try{Oi.exports=Ri()(__dirname)}catch{Oi.exports=ma()}});var Kt=N((vh,en)=>{"use strict";var{isUtf8:_a}=require("buffer"),gf=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Sf(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function Bi(n){let t=n.length,r=0;for(;r<t;)if(!(n[r]&128))r++;else if((n[r]&224)===192){if(r+1===t||(n[r+1]&192)!==128||(n[r]&254)===192)return!1;r+=2}else if((n[r]&240)===224){if(r+2>=t||(n[r+1]&192)!==128||(n[r+2]&192)!==128||n[r]===224&&(n[r+1]&224)===128||n[r]===237&&(n[r+1]&224)===160)return!1;r+=3}else if((n[r]&248)===240){if(r+3>=t||(n[r+1]&192)!==128||(n[r+2]&192)!==128||(n[r+3]&192)!==128||n[r]===240&&(n[r+1]&240)===128||n[r]===244&&n[r+1]>143||n[r]>244)return!1;r+=4}else return!1;return!0}en.exports={isValidStatusCode:Sf,isValidUTF8:Bi,tokenChars:gf};if(_a)en.exports.isValidUTF8=function(n){return n.length<24?Bi(n):_a(n)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let n=ba();en.exports.isValidUTF8=function(t){return t.length<32?Bi(t):n(t)}}catch{}});var qi=N((Eh,Ra)=>{"use strict";var{Writable:wf}=require("stream"),ya=Jt(),{BINARY_TYPES:vf,EMPTY_BUFFER:ga,kStatusCode:Ef,kWebSocket:Rf}=Ye(),{concat:Wi,toArrayBuffer:Tf,unmask:Cf}=Gt(),{isValidStatusCode:xf,isValidUTF8:Sa}=Kt(),tn=Buffer[Symbol.species],ae=0,wa=1,va=2,Ea=3,Li=4,Ii=5,rn=6,Di=class extends wf{constructor(t={}){super(),this._allowSynchronousEvents=t.allowSynchronousEvents!==void 0?t.allowSynchronousEvents:!0,this._binaryType=t.binaryType||vf[0],this._extensions=t.extensions||{},this._isServer=!!t.isServer,this._maxPayload=t.maxPayload|0,this._skipUTF8Validation=!!t.skipUTF8Validation,this[Rf]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=ae}_write(t,r,s){if(this._opcode===8&&this._state==ae)return s();this._bufferedBytes+=t.length,this._buffers.push(t),this.startLoop(s)}consume(t){if(this._bufferedBytes-=t,t===this._buffers[0].length)return this._buffers.shift();if(t<this._buffers[0].length){let s=this._buffers[0];return this._buffers[0]=new tn(s.buffer,s.byteOffset+t,s.length-t),new tn(s.buffer,s.byteOffset,t)}let r=Buffer.allocUnsafe(t);do{let s=this._buffers[0],o=r.length-t;t>=s.length?r.set(this._buffers.shift(),o):(r.set(new Uint8Array(s.buffer,s.byteOffset,t),o),this._buffers[0]=new tn(s.buffer,s.byteOffset+t,s.length-t)),t-=s.length}while(t>0);return r}startLoop(t){this._loop=!0;do switch(this._state){case ae:this.getInfo(t);break;case wa:this.getPayloadLength16(t);break;case va:this.getPayloadLength64(t);break;case Ea:this.getMask();break;case Li:this.getData(t);break;case Ii:case rn:this._loop=!1;return}while(this._loop);this._errored||t()}getInfo(t){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if(r[0]&48){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");t(o);return}let s=(r[0]&64)===64;if(s&&!this._extensions[ya.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");t(o);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(s){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");t(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");t(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");t(o);return}this._compressed=s}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");t(o);return}if(s){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");t(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");t(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");t(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");t(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");t(o);return}this._payloadLength===126?this._state=wa:this._payloadLength===127?this._state=va:this.haveLength(t)}getPayloadLength16(t){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(t)}getPayloadLength64(t){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),s=r.readUInt32BE(0);if(s>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");t(o);return}this._payloadLength=s*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(t)}haveLength(t){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(r);return}this._masked?this._state=Ea:this._state=Li}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Li}getData(t){let r=ga;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&Cf(r,this._mask)}if(this._opcode>7){this.controlMessage(r,t);return}if(this._compressed){this._state=Ii,this.decompress(r,t);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(t)}decompress(t,r){this._extensions[ya.extensionName].decompress(t,this._fin,(o,l)=>{if(o)return r(o);if(l.length){if(this._messageLength+=l.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let c=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(c);return}this._fragments.push(l)}this.dataMessage(r),this._state===ae&&this.startLoop(r)})}dataMessage(t){if(!this._fin){this._state=ae;return}let r=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=Wi(s,r):this._binaryType==="arraybuffer"?o=Tf(Wi(s,r)):o=s,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=ae):(this._state=rn,setImmediate(()=>{this.emit("message",o,!0),this._state=ae,this.startLoop(t)}))}else{let o=Wi(s,r);if(!this._skipUTF8Validation&&!Sa(o)){let l=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(l);return}this._state===Ii||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=ae):(this._state=rn,setImmediate(()=>{this.emit("message",o,!1),this._state=ae,this.startLoop(t)}))}}controlMessage(t,r){if(this._opcode===8){if(t.length===0)this._loop=!1,this.emit("conclude",1005,ga),this.end();else{let s=t.readUInt16BE(0);if(!xf(s)){let l=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(l);return}let o=new tn(t.buffer,t.byteOffset+2,t.length-2);if(!this._skipUTF8Validation&&!Sa(o)){let l=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(l);return}this._loop=!1,this.emit("conclude",s,o),this.end()}this._state=ae;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",t),this._state=ae):(this._state=rn,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",t),this._state=ae,this.startLoop(r)}))}createError(t,r,s,o,l){this._loop=!1,this._errored=!0;let c=new t(s?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(c,this.createError),c.code=l,c[Ef]=o,c}};Ra.exports=Di});var Fi=N((Th,xa)=>{"use strict";var{Duplex:Rh}=require("stream"),{randomFillSync:kf}=require("crypto"),Ta=Jt(),{EMPTY_BUFFER:Pf}=Ye(),{isValidStatusCode:Af}=Kt(),{mask:Ca,toBuffer:At}=Gt(),pe=Symbol("kByteLength"),Of=Buffer.alloc(4),Ui=class n{constructor(t,r,s){this._extensions=r||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=t,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(t,r){let s,o=!1,l=2,c=!1;r.mask&&(s=r.maskBuffer||Of,r.generateMask?r.generateMask(s):kf(s,0,4),c=(s[0]|s[1]|s[2]|s[3])===0,l=6);let _;typeof t=="string"?(!r.mask||c)&&r[pe]!==void 0?_=r[pe]:(t=Buffer.from(t),_=t.length):(_=t.length,o=r.mask&&r.readOnly&&!c);let p=_;_>=65536?(l+=8,p=127):_>125&&(l+=2,p=126);let d=Buffer.allocUnsafe(o?_+l:l);return d[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(d[0]|=64),d[1]=p,p===126?d.writeUInt16BE(_,2):p===127&&(d[2]=d[3]=0,d.writeUIntBE(_,4,6)),r.mask?(d[1]|=128,d[l-4]=s[0],d[l-3]=s[1],d[l-2]=s[2],d[l-1]=s[3],c?[d,t]:o?(Ca(t,s,d,l,_),[d]):(Ca(t,s,t,0,_),[d,t])):[d,t]}close(t,r,s,o){let l;if(t===void 0)l=Pf;else{if(typeof t!="number"||!Af(t))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)l=Buffer.allocUnsafe(2),l.writeUInt16BE(t,0);else{let _=Buffer.byteLength(r);if(_>123)throw new RangeError("The message must not be greater than 123 bytes");l=Buffer.allocUnsafe(2+_),l.writeUInt16BE(t,0),typeof r=="string"?l.write(r,2):l.set(r,2)}}let c={[pe]:l.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,l,!1,c,o]):this.sendFrame(n.frame(l,c),o)}ping(t,r,s){let o,l;if(typeof t=="string"?(o=Buffer.byteLength(t),l=!1):(t=At(t),o=t.length,l=At.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let c={[pe]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:l,rsv1:!1};this._deflating?this.enqueue([this.dispatch,t,!1,c,s]):this.sendFrame(n.frame(t,c),s)}pong(t,r,s){let o,l;if(typeof t=="string"?(o=Buffer.byteLength(t),l=!1):(t=At(t),o=t.length,l=At.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let c={[pe]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:l,rsv1:!1};this._deflating?this.enqueue([this.dispatch,t,!1,c,s]):this.sendFrame(n.frame(t,c),s)}send(t,r,s){let o=this._extensions[Ta.extensionName],l=r.binary?2:1,c=r.compress,_,p;if(typeof t=="string"?(_=Buffer.byteLength(t),p=!1):(t=At(t),_=t.length,p=At.readOnly),this._firstFragment?(this._firstFragment=!1,c&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=_>=o._threshold),this._compress=c):(c=!1,l=0),r.fin&&(this._firstFragment=!0),o){let d={[pe]:_,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:l,readOnly:p,rsv1:c};this._deflating?this.enqueue([this.dispatch,t,this._compress,d,s]):this.dispatch(t,this._compress,d,s)}else this.sendFrame(n.frame(t,{[pe]:_,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:l,readOnly:p,rsv1:!1}),s)}dispatch(t,r,s,o){if(!r){this.sendFrame(n.frame(t,s),o);return}let l=this._extensions[Ta.extensionName];this._bufferedBytes+=s[pe],this._deflating=!0,l.compress(t,s.fin,(c,_)=>{if(this._socket.destroyed){let p=new Error("The socket was closed while data was being compressed");typeof o=="function"&&o(p);for(let d=0;d<this._queue.length;d++){let h=this._queue[d],g=h[h.length-1];typeof g=="function"&&g(p)}return}this._bufferedBytes-=s[pe],this._deflating=!1,s.readOnly=!1,this.sendFrame(n.frame(_,s),o),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let t=this._queue.shift();this._bufferedBytes-=t[3][pe],Reflect.apply(t[0],this,t.slice(1))}}enqueue(t){this._bufferedBytes+=t[3][pe],this._queue.push(t)}sendFrame(t,r){t.length===2?(this._socket.cork(),this._socket.write(t[0]),this._socket.write(t[1],r),this._socket.uncork()):this._socket.write(t[0],r)}};xa.exports=Ui});var Da=N((Ch,Ia)=>{"use strict";var{kForOnEventAttribute:Xt,kListener:Ni}=Ye(),ka=Symbol("kCode"),Pa=Symbol("kData"),Aa=Symbol("kError"),Oa=Symbol("kMessage"),Ba=Symbol("kReason"),Ot=Symbol("kTarget"),Wa=Symbol("kType"),La=Symbol("kWasClean"),Le=class{constructor(t){this[Ot]=null,this[Wa]=t}get target(){return this[Ot]}get type(){return this[Wa]}};Object.defineProperty(Le.prototype,"target",{enumerable:!0});Object.defineProperty(Le.prototype,"type",{enumerable:!0});var ct=class extends Le{constructor(t,r={}){super(t),this[ka]=r.code===void 0?0:r.code,this[Ba]=r.reason===void 0?"":r.reason,this[La]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[ka]}get reason(){return this[Ba]}get wasClean(){return this[La]}};Object.defineProperty(ct.prototype,"code",{enumerable:!0});Object.defineProperty(ct.prototype,"reason",{enumerable:!0});Object.defineProperty(ct.prototype,"wasClean",{enumerable:!0});var Bt=class extends Le{constructor(t,r={}){super(t),this[Aa]=r.error===void 0?null:r.error,this[Oa]=r.message===void 0?"":r.message}get error(){return this[Aa]}get message(){return this[Oa]}};Object.defineProperty(Bt.prototype,"error",{enumerable:!0});Object.defineProperty(Bt.prototype,"message",{enumerable:!0});var Zt=class extends Le{constructor(t,r={}){super(t),this[Pa]=r.data===void 0?null:r.data}get data(){return this[Pa]}};Object.defineProperty(Zt.prototype,"data",{enumerable:!0});var Bf={addEventListener(n,t,r={}){for(let o of this.listeners(n))if(!r[Xt]&&o[Ni]===t&&!o[Xt])return;let s;if(n==="message")s=function(l,c){let _=new Zt("message",{data:c?l:l.toString()});_[Ot]=this,nn(t,this,_)};else if(n==="close")s=function(l,c){let _=new ct("close",{code:l,reason:c.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});_[Ot]=this,nn(t,this,_)};else if(n==="error")s=function(l){let c=new Bt("error",{error:l,message:l.message});c[Ot]=this,nn(t,this,c)};else if(n==="open")s=function(){let l=new Le("open");l[Ot]=this,nn(t,this,l)};else return;s[Xt]=!!r[Xt],s[Ni]=t,r.once?this.once(n,s):this.on(n,s)},removeEventListener(n,t){for(let r of this.listeners(n))if(r[Ni]===t&&!r[Xt]){this.removeListener(n,r);break}}};Ia.exports={CloseEvent:ct,ErrorEvent:Bt,Event:Le,EventTarget:Bf,MessageEvent:Zt};function nn(n,t,r){typeof n=="object"&&n.handleEvent?n.handleEvent.call(n,r):n.call(t,r)}});var Mi=N((xh,qa)=>{"use strict";var{tokenChars:er}=Kt();function Se(n,t,r){n[t]===void 0?n[t]=[r]:n[t].push(r)}function Wf(n){let t=Object.create(null),r=Object.create(null),s=!1,o=!1,l=!1,c,_,p=-1,d=-1,h=-1,g=0;for(;g<n.length;g++)if(d=n.charCodeAt(g),c===void 0)if(h===-1&&er[d]===1)p===-1&&(p=g);else if(g!==0&&(d===32||d===9))h===-1&&p!==-1&&(h=g);else if(d===59||d===44){if(p===-1)throw new SyntaxError(`Unexpected character at index ${g}`);h===-1&&(h=g);let P=n.slice(p,h);d===44?(Se(t,P,r),r=Object.create(null)):c=P,p=h=-1}else throw new SyntaxError(`Unexpected character at index ${g}`);else if(_===void 0)if(h===-1&&er[d]===1)p===-1&&(p=g);else if(d===32||d===9)h===-1&&p!==-1&&(h=g);else if(d===59||d===44){if(p===-1)throw new SyntaxError(`Unexpected character at index ${g}`);h===-1&&(h=g),Se(r,n.slice(p,h),!0),d===44&&(Se(t,c,r),r=Object.create(null),c=void 0),p=h=-1}else if(d===61&&p!==-1&&h===-1)_=n.slice(p,g),p=h=-1;else throw new SyntaxError(`Unexpected character at index ${g}`);else if(o){if(er[d]!==1)throw new SyntaxError(`Unexpected character at index ${g}`);p===-1?p=g:s||(s=!0),o=!1}else if(l)if(er[d]===1)p===-1&&(p=g);else if(d===34&&p!==-1)l=!1,h=g;else if(d===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${g}`);else if(d===34&&n.charCodeAt(g-1)===61)l=!0;else if(h===-1&&er[d]===1)p===-1&&(p=g);else if(p!==-1&&(d===32||d===9))h===-1&&(h=g);else if(d===59||d===44){if(p===-1)throw new SyntaxError(`Unexpected character at index ${g}`);h===-1&&(h=g);let P=n.slice(p,h);s&&(P=P.replace(/\\/g,""),s=!1),Se(r,_,P),d===44&&(Se(t,c,r),r=Object.create(null),c=void 0),_=void 0,p=h=-1}else throw new SyntaxError(`Unexpected character at index ${g}`);if(p===-1||l||d===32||d===9)throw new SyntaxError("Unexpected end of input");h===-1&&(h=g);let v=n.slice(p,h);return c===void 0?Se(t,v,r):(_===void 0?Se(r,v,!0):s?Se(r,_,v.replace(/\\/g,"")):Se(r,_,v),Se(t,c,r)),t}function Lf(n){return Object.keys(n).map(t=>{let r=n[t];return Array.isArray(r)||(r=[r]),r.map(s=>[t].concat(Object.keys(s).map(o=>{let l=s[o];return Array.isArray(l)||(l=[l]),l.map(c=>c===!0?o:`${o}=${c}`).join("; ")})).join("; ")).join(", ")}).join(", ")}qa.exports={format:Lf,parse:Wf}});var Hi=N((Ah,Ya)=>{"use strict";var If=require("events"),Df=require("https"),qf=require("http"),Na=require("net"),Uf=require("tls"),{randomBytes:Ff,createHash:Nf}=require("crypto"),{Duplex:kh,Readable:Ph}=require("stream"),{URL:$i}=require("url"),Je=Jt(),Mf=qi(),$f=Fi(),{BINARY_TYPES:Ua,EMPTY_BUFFER:sn,GUID:jf,kForOnEventAttribute:ji,kListener:zf,kStatusCode:Vf,kWebSocket:H,NOOP:Ma}=Ye(),{EventTarget:{addEventListener:Hf,removeEventListener:Gf}}=Da(),{format:Yf,parse:Qf}=Mi(),{toBuffer:Jf}=Gt(),Kf=30*1e3,$a=Symbol("kAborted"),zi=[8,13],Ie=["CONNECTING","OPEN","CLOSING","CLOSED"],Xf=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,M=class n extends If{constructor(t,r,s){super(),this._binaryType=Ua[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=sn,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=n.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,t!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(s=r,r=[]):r=[r]),ja(this,t,r,s)):(this._autoPong=s.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(t){Ua.includes(t)&&(this._binaryType=t,this._receiver&&(this._receiver._binaryType=t))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(t,r,s){let o=new Mf({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation});this._sender=new $f(t,this._extensions,s.generateMask),this._receiver=o,this._socket=t,o[H]=this,t[H]=this,o.on("conclude",td),o.on("drain",rd),o.on("error",nd),o.on("message",id),o.on("ping",sd),o.on("pong",od),t.setTimeout&&t.setTimeout(0),t.setNoDelay&&t.setNoDelay(),r.length>0&&t.unshift(r),t.on("close",Va),t.on("data",an),t.on("end",Ha),t.on("error",Ga),this._readyState=n.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=n.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Je.extensionName]&&this._extensions[Je.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=n.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(t,r){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){ee(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===n.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=n.CLOSING,this._sender.close(t,r,!this._isServer,s=>{s||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Kf)}}pause(){this.readyState===n.CONNECTING||this.readyState===n.CLOSED||(this._paused=!0,this._socket.pause())}ping(t,r,s){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"?(s=t,t=r=void 0):typeof r=="function"&&(s=r,r=void 0),typeof t=="number"&&(t=t.toString()),this.readyState!==n.OPEN){Vi(this,t,s);return}r===void 0&&(r=!this._isServer),this._sender.ping(t||sn,r,s)}pong(t,r,s){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"?(s=t,t=r=void 0):typeof r=="function"&&(s=r,r=void 0),typeof t=="number"&&(t=t.toString()),this.readyState!==n.OPEN){Vi(this,t,s);return}r===void 0&&(r=!this._isServer),this._sender.pong(t||sn,r,s)}resume(){this.readyState===n.CONNECTING||this.readyState===n.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(t,r,s){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(s=r,r={}),typeof t=="number"&&(t=t.toString()),this.readyState!==n.OPEN){Vi(this,t,s);return}let o={binary:typeof t!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[Je.extensionName]||(o.compress=!1),this._sender.send(t||sn,o,s)}terminate(){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){ee(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=n.CLOSING,this._socket.destroy())}}};Object.defineProperty(M,"CONNECTING",{enumerable:!0,value:Ie.indexOf("CONNECTING")});Object.defineProperty(M.prototype,"CONNECTING",{enumerable:!0,value:Ie.indexOf("CONNECTING")});Object.defineProperty(M,"OPEN",{enumerable:!0,value:Ie.indexOf("OPEN")});Object.defineProperty(M.prototype,"OPEN",{enumerable:!0,value:Ie.indexOf("OPEN")});Object.defineProperty(M,"CLOSING",{enumerable:!0,value:Ie.indexOf("CLOSING")});Object.defineProperty(M.prototype,"CLOSING",{enumerable:!0,value:Ie.indexOf("CLOSING")});Object.defineProperty(M,"CLOSED",{enumerable:!0,value:Ie.indexOf("CLOSED")});Object.defineProperty(M.prototype,"CLOSED",{enumerable:!0,value:Ie.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(n=>{Object.defineProperty(M.prototype,n,{enumerable:!0})});["open","error","close","message"].forEach(n=>{Object.defineProperty(M.prototype,`on${n}`,{enumerable:!0,get(){for(let t of this.listeners(n))if(t[ji])return t[zf];return null},set(t){for(let r of this.listeners(n))if(r[ji]){this.removeListener(n,r);break}typeof t=="function"&&this.addEventListener(n,t,{[ji]:!0})}})});M.prototype.addEventListener=Hf;M.prototype.removeEventListener=Gf;Ya.exports=M;function ja(n,t,r,s){let o={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:zi[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(n._autoPong=o.autoPong,!zi.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${zi.join(", ")})`);let l;if(t instanceof $i)l=t;else try{l=new $i(t)}catch{throw new SyntaxError(`Invalid URL: ${t}`)}l.protocol==="http:"?l.protocol="ws:":l.protocol==="https:"&&(l.protocol="wss:"),n._url=l.href;let c=l.protocol==="wss:",_=l.protocol==="ws+unix:",p;if(l.protocol!=="ws:"&&!c&&!_?p=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:_&&!l.pathname?p="The URL's pathname is empty":l.hash&&(p="The URL contains a fragment identifier"),p){let w=new SyntaxError(p);if(n._redirects===0)throw w;on(n,w);return}let d=c?443:80,h=Ff(16).toString("base64"),g=c?Df.request:qf.request,v=new Set,P;if(o.createConnection=o.createConnection||(c?ed:Zf),o.defaultPort=o.defaultPort||d,o.port=l.port||d,o.host=l.hostname.startsWith("[")?l.hostname.slice(1,-1):l.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},o.path=l.pathname+l.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(P=new Je(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=Yf({[Je.extensionName]:P.offer()})),r.length){for(let w of r){if(typeof w!="string"||!Xf.test(w)||v.has(w))throw new SyntaxError("An invalid or duplicated subprotocol was specified");v.add(w)}o.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(l.username||l.password)&&(o.auth=`${l.username}:${l.password}`),_){let w=o.path.split(":");o.socketPath=w[0],o.path=w[1]}let y;if(o.followRedirects){if(n._redirects===0){n._originalIpc=_,n._originalSecure=c,n._originalHostOrSocketPath=_?o.socketPath:l.host;let w=s&&s.headers;if(s={...s,headers:{}},w)for(let[T,k]of Object.entries(w))s.headers[T.toLowerCase()]=k}else if(n.listenerCount("redirect")===0){let w=_?n._originalIpc?o.socketPath===n._originalHostOrSocketPath:!1:n._originalIpc?!1:l.host===n._originalHostOrSocketPath;(!w||n._originalSecure&&!c)&&(delete o.headers.authorization,delete o.headers.cookie,w||delete o.headers.host,o.auth=void 0)}o.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),y=n._req=g(o),n._redirects&&n.emit("redirect",n.url,y)}else y=n._req=g(o);o.timeout&&y.on("timeout",()=>{ee(n,y,"Opening handshake has timed out")}),y.on("error",w=>{y===null||y[$a]||(y=n._req=null,on(n,w))}),y.on("response",w=>{let T=w.headers.location,k=w.statusCode;if(T&&o.followRedirects&&k>=300&&k<400){if(++n._redirects>o.maxRedirects){ee(n,y,"Maximum redirects exceeded");return}y.abort();let L;try{L=new $i(T,t)}catch{let O=new SyntaxError(`Invalid URL: ${T}`);on(n,O);return}ja(n,L,r,s)}else n.emit("unexpected-response",y,w)||ee(n,y,`Unexpected server response: ${w.statusCode}`)}),y.on("upgrade",(w,T,k)=>{if(n.emit("upgrade",w),n.readyState!==M.CONNECTING)return;if(y=n._req=null,w.headers.upgrade.toLowerCase()!=="websocket"){ee(n,T,"Invalid Upgrade header");return}let L=Nf("sha1").update(h+jf).digest("base64");if(w.headers["sec-websocket-accept"]!==L){ee(n,T,"Invalid Sec-WebSocket-Accept header");return}let F=w.headers["sec-websocket-protocol"],O;if(F!==void 0?v.size?v.has(F)||(O="Server sent an invalid subprotocol"):O="Server sent a subprotocol but none was requested":v.size&&(O="Server sent no subprotocol"),O){ee(n,T,O);return}F&&(n._protocol=F);let W=w.headers["sec-websocket-extensions"];if(W!==void 0){if(!P){ee(n,T,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let I;try{I=Qf(W)}catch{ee(n,T,"Invalid Sec-WebSocket-Extensions header");return}let ue=Object.keys(I);if(ue.length!==1||ue[0]!==Je.extensionName){ee(n,T,"Server indicated an extension that was not requested");return}try{P.accept(I[Je.extensionName])}catch{ee(n,T,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[Je.extensionName]=P}n.setSocket(T,k,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(y,n):y.end()}function on(n,t){n._readyState=M.CLOSING,n.emit("error",t),n.emitClose()}function Zf(n){return n.path=n.socketPath,Na.connect(n)}function ed(n){return n.path=void 0,!n.servername&&n.servername!==""&&(n.servername=Na.isIP(n.host)?"":n.host),Uf.connect(n)}function ee(n,t,r){n._readyState=M.CLOSING;let s=new Error(r);Error.captureStackTrace(s,ee),t.setHeader?(t[$a]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(on,n,s)):(t.destroy(s),t.once("error",n.emit.bind(n,"error")),t.once("close",n.emitClose.bind(n)))}function Vi(n,t,r){if(t){let s=Jf(t).length;n._socket?n._sender._bufferedBytes+=s:n._bufferedAmount+=s}if(r){let s=new Error(`WebSocket is not open: readyState ${n.readyState} (${Ie[n.readyState]})`);process.nextTick(r,s)}}function td(n,t){let r=this[H];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=n,r._socket[H]!==void 0&&(r._socket.removeListener("data",an),process.nextTick(za,r._socket),n===1005?r.close():r.close(n,t))}function rd(){let n=this[H];n.isPaused||n._socket.resume()}function nd(n){let t=this[H];t._socket[H]!==void 0&&(t._socket.removeListener("data",an),process.nextTick(za,t._socket),t.close(n[Vf])),t.emit("error",n)}function Fa(){this[H].emitClose()}function id(n,t){this[H].emit("message",n,t)}function sd(n){let t=this[H];t._autoPong&&t.pong(n,!this._isServer,Ma),t.emit("ping",n)}function od(n){this[H].emit("pong",n)}function za(n){n.resume()}function Va(){let n=this[H];this.removeListener("close",Va),this.removeListener("data",an),this.removeListener("end",Ha),n._readyState=M.CLOSING;let t;!this._readableState.endEmitted&&!n._closeFrameReceived&&!n._receiver._writableState.errorEmitted&&(t=n._socket.read())!==null&&n._receiver.write(t),n._receiver.end(),this[H]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",Fa),n._receiver.on("finish",Fa))}function an(n){this[H]._receiver.write(n)||this.pause()}function Ha(){let n=this[H];n._readyState=M.CLOSING,n._receiver.end(),this.end()}function Ga(){let n=this[H];this.removeListener("error",Ga),this.on("error",Ma),n&&(n._readyState=M.CLOSING,this.destroy())}});var Ja=N((Oh,Qa)=>{"use strict";var{tokenChars:ad}=Kt();function ld(n){let t=new Set,r=-1,s=-1,o=0;for(o;o<n.length;o++){let c=n.charCodeAt(o);if(s===-1&&ad[c]===1)r===-1&&(r=o);else if(o!==0&&(c===32||c===9))s===-1&&r!==-1&&(s=o);else if(c===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${o}`);s===-1&&(s=o);let _=n.slice(r,s);if(t.has(_))throw new SyntaxError(`The "${_}" subprotocol is duplicated`);t.add(_),r=s=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(r===-1||s!==-1)throw new SyntaxError("Unexpected end of input");let l=n.slice(r,o);if(t.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);return t.add(l),t}Qa.exports={parse:ld}});var nl=N((Wh,rl)=>{"use strict";var ud=require("events"),ln=require("http"),{Duplex:Bh}=require("stream"),{createHash:cd}=require("crypto"),Ka=Mi(),ft=Jt(),fd=Ja(),dd=Hi(),{GUID:hd,kWebSocket:pd}=Ye(),md=/^[+/0-9A-Za-z]{22}==$/,Xa=0,Za=1,tl=2,Gi=class extends ud{constructor(t,r){if(super(),t={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:dd,...t},t.port==null&&!t.server&&!t.noServer||t.port!=null&&(t.server||t.noServer)||t.server&&t.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(t.port!=null?(this._server=ln.createServer((s,o)=>{let l=ln.STATUS_CODES[426];o.writeHead(426,{"Content-Length":l.length,"Content-Type":"text/plain"}),o.end(l)}),this._server.listen(t.port,t.host,t.backlog,r)):t.server&&(this._server=t.server),this._server){let s=this.emit.bind(this,"connection");this._removeListeners=bd(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,l,c)=>{this.handleUpgrade(o,l,c,s)}})}t.perMessageDeflate===!0&&(t.perMessageDeflate={}),t.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=t,this._state=Xa}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(t){if(this._state===tl){t&&this.once("close",()=>{t(new Error("The server is not running"))}),process.nextTick(tr,this);return}if(t&&this.once("close",t),this._state!==Za)if(this._state=Za,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(tr,this):process.nextTick(tr,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{tr(this)})}}shouldHandle(t){if(this.options.path){let r=t.url.indexOf("?");if((r!==-1?t.url.slice(0,r):t.url)!==this.options.path)return!1}return!0}handleUpgrade(t,r,s,o){r.on("error",el);let l=t.headers["sec-websocket-key"],c=+t.headers["sec-websocket-version"];if(t.method!=="GET"){dt(this,t,r,405,"Invalid HTTP method");return}if(t.headers.upgrade.toLowerCase()!=="websocket"){dt(this,t,r,400,"Invalid Upgrade header");return}if(!l||!md.test(l)){dt(this,t,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(c!==8&&c!==13){dt(this,t,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(t)){rr(r,400);return}let _=t.headers["sec-websocket-protocol"],p=new Set;if(_!==void 0)try{p=fd.parse(_)}catch{dt(this,t,r,400,"Invalid Sec-WebSocket-Protocol header");return}let d=t.headers["sec-websocket-extensions"],h={};if(this.options.perMessageDeflate&&d!==void 0){let g=new ft(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let v=Ka.parse(d);v[ft.extensionName]&&(g.accept(v[ft.extensionName]),h[ft.extensionName]=g)}catch{dt(this,t,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let g={origin:t.headers[`${c===8?"sec-websocket-origin":"origin"}`],secure:!!(t.socket.authorized||t.socket.encrypted),req:t};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(v,P,y,w)=>{if(!v)return rr(r,P||401,y,w);this.completeUpgrade(h,l,p,t,r,s,o)});return}if(!this.options.verifyClient(g))return rr(r,401)}this.completeUpgrade(h,l,p,t,r,s,o)}completeUpgrade(t,r,s,o,l,c,_){if(!l.readable||!l.writable)return l.destroy();if(l[pd])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Xa)return rr(l,503);let d=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${cd("sha1").update(r+hd).digest("base64")}`],h=new this.options.WebSocket(null,void 0,this.options);if(s.size){let g=this.options.handleProtocols?this.options.handleProtocols(s,o):s.values().next().value;g&&(d.push(`Sec-WebSocket-Protocol: ${g}`),h._protocol=g)}if(t[ft.extensionName]){let g=t[ft.extensionName].params,v=Ka.format({[ft.extensionName]:[g]});d.push(`Sec-WebSocket-Extensions: ${v}`),h._extensions=t}this.emit("headers",d,o),l.write(d.concat(`\r
`).join(`\r
`)),l.removeListener("error",el),h.setSocket(l,c,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(tr,this)})),_(h,o)}};rl.exports=Gi;function bd(n,t){for(let r of Object.keys(t))n.on(r,t[r]);return function(){for(let s of Object.keys(t))n.removeListener(s,t[s])}}function tr(n){n._state=tl,n.emit("close")}function el(){this.destroy()}function rr(n,t,r,s){r=r||ln.STATUS_CODES[t],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...s},n.once("finish",n.destroy),n.end(`HTTP/1.1 ${t} ${ln.STATUS_CODES[t]}\r
`+Object.keys(s).map(o=>`${o}: ${s[o]}`).join(`\r
`)+`\r
\r
`+r)}function dt(n,t,r,s,o){if(n.listenerCount("wsClientError")){let l=new Error(o);Error.captureStackTrace(l,dt),n.emit("wsClientError",l,r,t)}else rr(r,s,o)}});function Td(n){if(!/^data:/i.test(n))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');n=n.replace(/\r?\n/g,"");let t=n.indexOf(",");if(t===-1||t<=4)throw new TypeError("malformed data: URI");let r=n.substring(5,t).split(";"),s="",o=!1,l=r[0]||"text/plain",c=l;for(let h=1;h<r.length;h++)r[h]==="base64"?o=!0:r[h]&&(c+=`;${r[h]}`,r[h].indexOf("charset=")===0&&(s=r[h].substring(8)));!r[0]&&!s.length&&(c+=";charset=US-ASCII",s="US-ASCII");let _=o?"base64":"ascii",p=unescape(n.substring(t+1)),d=Buffer.from(p,_);return d.type=l,d.typeFull=c,d.charset=s,d}var ll,ul=$(()=>{ll=Td});var fl=N((bn,cl)=>{(function(n,t){typeof bn=="object"&&typeof cl<"u"?t(bn):typeof define=="function"&&define.amd?define(["exports"],t):(n=typeof globalThis<"u"?globalThis:n||self,t(n.WebStreamsPolyfill={}))})(bn,function(n){"use strict";function t(){}function r(e){return typeof e=="object"&&e!==null||typeof e=="function"}let s=t;function o(e,i){try{Object.defineProperty(e,"name",{value:i,configurable:!0})}catch{}}let l=Promise,c=Promise.prototype.then,_=Promise.reject.bind(l);function p(e){return new l(e)}function d(e){return p(i=>i(e))}function h(e){return _(e)}function g(e,i,a){return c.call(e,i,a)}function v(e,i,a){g(g(e,i,a),void 0,s)}function P(e,i){v(e,i)}function y(e,i){v(e,void 0,i)}function w(e,i,a){return g(e,i,a)}function T(e){g(e,void 0,s)}let k=e=>{if(typeof queueMicrotask=="function")k=queueMicrotask;else{let i=d(void 0);k=a=>g(i,a)}return k(e)};function L(e,i,a){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,i,a)}function F(e,i,a){try{return d(L(e,i,a))}catch(u){return h(u)}}let O=16384;class W{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(i){let a=this._back,u=a;a._elements.length===O-1&&(u={_elements:[],_next:void 0}),a._elements.push(i),u!==a&&(this._back=u,a._next=u),++this._size}shift(){let i=this._front,a=i,u=this._cursor,f=u+1,m=i._elements,b=m[u];return f===O&&(a=i._next,f=0),--this._size,this._cursor=f,i!==a&&(this._front=a),m[u]=void 0,b}forEach(i){let a=this._cursor,u=this._front,f=u._elements;for(;(a!==f.length||u._next!==void 0)&&!(a===f.length&&(u=u._next,f=u._elements,a=0,f.length===0));)i(f[a]),++a}peek(){let i=this._front,a=this._cursor;return i._elements[a]}}let I=Symbol("[[AbortSteps]]"),ue=Symbol("[[ErrorSteps]]"),Ee=Symbol("[[CancelSteps]]"),It=Symbol("[[PullSteps]]"),Pn=Symbol("[[ReleaseSteps]]");function ds(e,i){e._ownerReadableStream=i,i._reader=e,i._state==="readable"?On(e):i._state==="closed"?ru(e):hs(e,i._storedError)}function An(e,i){let a=e._ownerReadableStream;return fe(a,i)}function Re(e){let i=e._ownerReadableStream;i._state==="readable"?Bn(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):nu(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),i._readableStreamController[Pn](),i._reader=void 0,e._ownerReadableStream=void 0}function br(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function On(e){e._closedPromise=p((i,a)=>{e._closedPromise_resolve=i,e._closedPromise_reject=a})}function hs(e,i){On(e),Bn(e,i)}function ru(e){On(e),ps(e)}function Bn(e,i){e._closedPromise_reject!==void 0&&(T(e._closedPromise),e._closedPromise_reject(i),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function nu(e,i){hs(e,i)}function ps(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let ms=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},iu=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function su(e){return typeof e=="object"||typeof e=="function"}function _e(e,i){if(e!==void 0&&!su(e))throw new TypeError(`${i} is not an object.`)}function ie(e,i){if(typeof e!="function")throw new TypeError(`${i} is not a function.`)}function ou(e){return typeof e=="object"&&e!==null||typeof e=="function"}function bs(e,i){if(!ou(e))throw new TypeError(`${i} is not an object.`)}function Te(e,i,a){if(e===void 0)throw new TypeError(`Parameter ${i} is required in '${a}'.`)}function Wn(e,i,a){if(e===void 0)throw new TypeError(`${i} is required in '${a}'.`)}function Ln(e){return Number(e)}function _s(e){return e===0?0:e}function au(e){return _s(iu(e))}function In(e,i){let u=Number.MAX_SAFE_INTEGER,f=Number(e);if(f=_s(f),!ms(f))throw new TypeError(`${i} is not a finite number`);if(f=au(f),f<0||f>u)throw new TypeError(`${i} is outside the accepted range of 0 to ${u}, inclusive`);return!ms(f)||f===0?0:f}function Dn(e,i){if(!ze(e))throw new TypeError(`${i} is not a ReadableStream.`)}function _t(e){return new Ue(e)}function ys(e,i){e._reader._readRequests.push(i)}function qn(e,i,a){let f=e._reader._readRequests.shift();a?f._closeSteps():f._chunkSteps(i)}function _r(e){return e._reader._readRequests.length}function gs(e){let i=e._reader;return!(i===void 0||!Fe(i))}class Ue{constructor(i){if(Te(i,1,"ReadableStreamDefaultReader"),Dn(i,"First parameter"),Ve(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");ds(this,i),this._readRequests=new W}get closed(){return Fe(this)?this._closedPromise:h(yr("closed"))}cancel(i=void 0){return Fe(this)?this._ownerReadableStream===void 0?h(br("cancel")):An(this,i):h(yr("cancel"))}read(){if(!Fe(this))return h(yr("read"));if(this._ownerReadableStream===void 0)return h(br("read from"));let i,a,u=p((m,b)=>{i=m,a=b});return Dt(this,{_chunkSteps:m=>i({value:m,done:!1}),_closeSteps:()=>i({value:void 0,done:!0}),_errorSteps:m=>a(m)}),u}releaseLock(){if(!Fe(this))throw yr("releaseLock");this._ownerReadableStream!==void 0&&lu(this)}}Object.defineProperties(Ue.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(Ue.prototype.cancel,"cancel"),o(Ue.prototype.read,"read"),o(Ue.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ue.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Fe(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof Ue}function Dt(e,i){let a=e._ownerReadableStream;a._disturbed=!0,a._state==="closed"?i._closeSteps():a._state==="errored"?i._errorSteps(a._storedError):a._readableStreamController[It](i)}function lu(e){Re(e);let i=new TypeError("Reader was released");Ss(e,i)}function Ss(e,i){let a=e._readRequests;e._readRequests=new W,a.forEach(u=>{u._errorSteps(i)})}function yr(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}let uu=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class ws{constructor(i,a){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=i,this._preventCancel=a}next(){let i=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?w(this._ongoingPromise,i,i):i(),this._ongoingPromise}return(i){let a=()=>this._returnSteps(i);return this._ongoingPromise?w(this._ongoingPromise,a,a):a()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let i=this._reader,a,u,f=p((b,S)=>{a=b,u=S});return Dt(i,{_chunkSteps:b=>{this._ongoingPromise=void 0,k(()=>a({value:b,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,Re(i),a({value:void 0,done:!0})},_errorSteps:b=>{this._ongoingPromise=void 0,this._isFinished=!0,Re(i),u(b)}}),f}_returnSteps(i){if(this._isFinished)return Promise.resolve({value:i,done:!0});this._isFinished=!0;let a=this._reader;if(!this._preventCancel){let u=An(a,i);return Re(a),w(u,()=>({value:i,done:!0}))}return Re(a),d({value:i,done:!0})}}let vs={next(){return Es(this)?this._asyncIteratorImpl.next():h(Rs("next"))},return(e){return Es(this)?this._asyncIteratorImpl.return(e):h(Rs("return"))}};Object.setPrototypeOf(vs,uu);function cu(e,i){let a=_t(e),u=new ws(a,i),f=Object.create(vs);return f._asyncIteratorImpl=u,f}function Es(e){if(!r(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof ws}catch{return!1}}function Rs(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}let Ts=Number.isNaN||function(e){return e!==e};var Un,Fn,Nn;function qt(e){return e.slice()}function Cs(e,i,a,u,f){new Uint8Array(e).set(new Uint8Array(a,u,f),i)}let Ce=e=>(typeof e.transfer=="function"?Ce=i=>i.transfer():typeof structuredClone=="function"?Ce=i=>structuredClone(i,{transfer:[i]}):Ce=i=>i,Ce(e)),Ne=e=>(typeof e.detached=="boolean"?Ne=i=>i.detached:Ne=i=>i.byteLength===0,Ne(e));function xs(e,i,a){if(e.slice)return e.slice(i,a);let u=a-i,f=new ArrayBuffer(u);return Cs(f,0,e,i,u),f}function gr(e,i){let a=e[i];if(a!=null){if(typeof a!="function")throw new TypeError(`${String(i)} is not a function`);return a}}function fu(e){let i={[Symbol.iterator]:()=>e.iterator},a=async function*(){return yield*i}(),u=a.next;return{iterator:a,nextMethod:u,done:!1}}let Mn=(Nn=(Un=Symbol.asyncIterator)!==null&&Un!==void 0?Un:(Fn=Symbol.for)===null||Fn===void 0?void 0:Fn.call(Symbol,"Symbol.asyncIterator"))!==null&&Nn!==void 0?Nn:"@@asyncIterator";function ks(e,i="sync",a){if(a===void 0)if(i==="async"){if(a=gr(e,Mn),a===void 0){let m=gr(e,Symbol.iterator),b=ks(e,"sync",m);return fu(b)}}else a=gr(e,Symbol.iterator);if(a===void 0)throw new TypeError("The object is not iterable");let u=L(a,e,[]);if(!r(u))throw new TypeError("The iterator method must return an object");let f=u.next;return{iterator:u,nextMethod:f,done:!1}}function du(e){let i=L(e.nextMethod,e.iterator,[]);if(!r(i))throw new TypeError("The iterator.next() method must return an object");return i}function hu(e){return!!e.done}function pu(e){return e.value}function mu(e){return!(typeof e!="number"||Ts(e)||e<0)}function Ps(e){let i=xs(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(i)}function $n(e){let i=e._queue.shift();return e._queueTotalSize-=i.size,e._queueTotalSize<0&&(e._queueTotalSize=0),i.value}function jn(e,i,a){if(!mu(a)||a===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:i,size:a}),e._queueTotalSize+=a}function bu(e){return e._queue.peek().value}function Me(e){e._queue=new W,e._queueTotalSize=0}function As(e){return e===DataView}function _u(e){return As(e.constructor)}function yu(e){return As(e)?1:e.BYTES_PER_ELEMENT}class tt{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!zn(this))throw Qn("view");return this._view}respond(i){if(!zn(this))throw Qn("respond");if(Te(i,1,"respond"),i=In(i,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Ne(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");Er(this._associatedReadableByteStreamController,i)}respondWithNewView(i){if(!zn(this))throw Qn("respondWithNewView");if(Te(i,1,"respondWithNewView"),!ArrayBuffer.isView(i))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Ne(i.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Rr(this._associatedReadableByteStreamController,i)}}Object.defineProperties(tt.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),o(tt.prototype.respond,"respond"),o(tt.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(tt.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class xe{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!rt(this))throw Ft("byobRequest");return Yn(this)}get desiredSize(){if(!rt(this))throw Ft("desiredSize");return Ns(this)}close(){if(!rt(this))throw Ft("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be closed`);Ut(this)}enqueue(i){if(!rt(this))throw Ft("enqueue");if(Te(i,1,"enqueue"),!ArrayBuffer.isView(i))throw new TypeError("chunk must be an array buffer view");if(i.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(i.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let a=this._controlledReadableByteStream._state;if(a!=="readable")throw new TypeError(`The stream (in ${a} state) is not in the readable state and cannot be enqueued to`);vr(this,i)}error(i=void 0){if(!rt(this))throw Ft("error");se(this,i)}[Ee](i){Os(this),Me(this);let a=this._cancelAlgorithm(i);return wr(this),a}[It](i){let a=this._controlledReadableByteStream;if(this._queueTotalSize>0){Fs(this,i);return}let u=this._autoAllocateChunkSize;if(u!==void 0){let f;try{f=new ArrayBuffer(u)}catch(b){i._errorSteps(b);return}let m={buffer:f,bufferByteLength:u,byteOffset:0,byteLength:u,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(m)}ys(a,i),nt(this)}[Pn](){if(this._pendingPullIntos.length>0){let i=this._pendingPullIntos.peek();i.readerType="none",this._pendingPullIntos=new W,this._pendingPullIntos.push(i)}}}Object.defineProperties(xe.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),o(xe.prototype.close,"close"),o(xe.prototype.enqueue,"enqueue"),o(xe.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(xe.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function rt(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof xe}function zn(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof tt}function nt(e){if(!Eu(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let a=e._pullAlgorithm();v(a,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,nt(e)),null),u=>(se(e,u),null))}function Os(e){Hn(e),e._pendingPullIntos=new W}function Vn(e,i){let a=!1;e._state==="closed"&&(a=!0);let u=Bs(i);i.readerType==="default"?qn(e,u,a):Pu(e,u,a)}function Bs(e){let i=e.bytesFilled,a=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,i/a)}function Sr(e,i,a,u){e._queue.push({buffer:i,byteOffset:a,byteLength:u}),e._queueTotalSize+=u}function Ws(e,i,a,u){let f;try{f=xs(i,a,a+u)}catch(m){throw se(e,m),m}Sr(e,f,0,u)}function Ls(e,i){i.bytesFilled>0&&Ws(e,i.buffer,i.byteOffset,i.bytesFilled),yt(e)}function Is(e,i){let a=Math.min(e._queueTotalSize,i.byteLength-i.bytesFilled),u=i.bytesFilled+a,f=a,m=!1,b=u%i.elementSize,S=u-b;S>=i.minimumFill&&(f=S-i.bytesFilled,m=!0);let C=e._queue;for(;f>0;){let E=C.peek(),x=Math.min(f,E.byteLength),A=i.byteOffset+i.bytesFilled;Cs(i.buffer,A,E.buffer,E.byteOffset,x),E.byteLength===x?C.shift():(E.byteOffset+=x,E.byteLength-=x),e._queueTotalSize-=x,Ds(e,x,i),f-=x}return m}function Ds(e,i,a){a.bytesFilled+=i}function qs(e){e._queueTotalSize===0&&e._closeRequested?(wr(e),Vt(e._controlledReadableByteStream)):nt(e)}function Hn(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Gn(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;let i=e._pendingPullIntos.peek();Is(e,i)&&(yt(e),Vn(e._controlledReadableByteStream,i))}}function gu(e){let i=e._controlledReadableByteStream._reader;for(;i._readRequests.length>0;){if(e._queueTotalSize===0)return;let a=i._readRequests.shift();Fs(e,a)}}function Su(e,i,a,u){let f=e._controlledReadableByteStream,m=i.constructor,b=yu(m),{byteOffset:S,byteLength:C}=i,E=a*b,x;try{x=Ce(i.buffer)}catch(D){u._errorSteps(D);return}let A={buffer:x,bufferByteLength:x.byteLength,byteOffset:S,byteLength:C,bytesFilled:0,minimumFill:E,elementSize:b,viewConstructor:m,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(A),js(f,u);return}if(f._state==="closed"){let D=new m(A.buffer,A.byteOffset,0);u._closeSteps(D);return}if(e._queueTotalSize>0){if(Is(e,A)){let D=Bs(A);qs(e),u._chunkSteps(D);return}if(e._closeRequested){let D=new TypeError("Insufficient bytes to fill elements in the given buffer");se(e,D),u._errorSteps(D);return}}e._pendingPullIntos.push(A),js(f,u),nt(e)}function wu(e,i){i.readerType==="none"&&yt(e);let a=e._controlledReadableByteStream;if(Jn(a))for(;zs(a)>0;){let u=yt(e);Vn(a,u)}}function vu(e,i,a){if(Ds(e,i,a),a.readerType==="none"){Ls(e,a),Gn(e);return}if(a.bytesFilled<a.minimumFill)return;yt(e);let u=a.bytesFilled%a.elementSize;if(u>0){let f=a.byteOffset+a.bytesFilled;Ws(e,a.buffer,f-u,u)}a.bytesFilled-=u,Vn(e._controlledReadableByteStream,a),Gn(e)}function Us(e,i){let a=e._pendingPullIntos.peek();Hn(e),e._controlledReadableByteStream._state==="closed"?wu(e,a):vu(e,i,a),nt(e)}function yt(e){return e._pendingPullIntos.shift()}function Eu(e){let i=e._controlledReadableByteStream;return i._state!=="readable"||e._closeRequested||!e._started?!1:!!(gs(i)&&_r(i)>0||Jn(i)&&zs(i)>0||Ns(e)>0)}function wr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function Ut(e){let i=e._controlledReadableByteStream;if(!(e._closeRequested||i._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0){let a=e._pendingPullIntos.peek();if(a.bytesFilled%a.elementSize!==0){let u=new TypeError("Insufficient bytes to fill elements in the given buffer");throw se(e,u),u}}wr(e),Vt(i)}}function vr(e,i){let a=e._controlledReadableByteStream;if(e._closeRequested||a._state!=="readable")return;let{buffer:u,byteOffset:f,byteLength:m}=i;if(Ne(u))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let b=Ce(u);if(e._pendingPullIntos.length>0){let S=e._pendingPullIntos.peek();if(Ne(S.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Hn(e),S.buffer=Ce(S.buffer),S.readerType==="none"&&Ls(e,S)}if(gs(a))if(gu(e),_r(a)===0)Sr(e,b,f,m);else{e._pendingPullIntos.length>0&&yt(e);let S=new Uint8Array(b,f,m);qn(a,S,!1)}else Jn(a)?(Sr(e,b,f,m),Gn(e)):Sr(e,b,f,m);nt(e)}function se(e,i){let a=e._controlledReadableByteStream;a._state==="readable"&&(Os(e),Me(e),wr(e),mo(a,i))}function Fs(e,i){let a=e._queue.shift();e._queueTotalSize-=a.byteLength,qs(e);let u=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);i._chunkSteps(u)}function Yn(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){let i=e._pendingPullIntos.peek(),a=new Uint8Array(i.buffer,i.byteOffset+i.bytesFilled,i.byteLength-i.bytesFilled),u=Object.create(tt.prototype);Tu(u,e,a),e._byobRequest=u}return e._byobRequest}function Ns(e){let i=e._controlledReadableByteStream._state;return i==="errored"?null:i==="closed"?0:e._strategyHWM-e._queueTotalSize}function Er(e,i){let a=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(i!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(i===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(a.bytesFilled+i>a.byteLength)throw new RangeError("bytesWritten out of range")}a.buffer=Ce(a.buffer),Us(e,i)}function Rr(e,i){let a=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(i.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(i.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(a.byteOffset+a.bytesFilled!==i.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(a.bufferByteLength!==i.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(a.bytesFilled+i.byteLength>a.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let f=i.byteLength;a.buffer=Ce(i.buffer),Us(e,f)}function Ms(e,i,a,u,f,m,b){i._controlledReadableByteStream=e,i._pullAgain=!1,i._pulling=!1,i._byobRequest=null,i._queue=i._queueTotalSize=void 0,Me(i),i._closeRequested=!1,i._started=!1,i._strategyHWM=m,i._pullAlgorithm=u,i._cancelAlgorithm=f,i._autoAllocateChunkSize=b,i._pendingPullIntos=new W,e._readableStreamController=i;let S=a();v(d(S),()=>(i._started=!0,nt(i),null),C=>(se(i,C),null))}function Ru(e,i,a){let u=Object.create(xe.prototype),f,m,b;i.start!==void 0?f=()=>i.start(u):f=()=>{},i.pull!==void 0?m=()=>i.pull(u):m=()=>d(void 0),i.cancel!==void 0?b=C=>i.cancel(C):b=()=>d(void 0);let S=i.autoAllocateChunkSize;if(S===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Ms(e,u,f,m,b,a,S)}function Tu(e,i,a){e._associatedReadableByteStreamController=i,e._view=a}function Qn(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function Ft(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function Cu(e,i){_e(e,i);let a=e?.mode;return{mode:a===void 0?void 0:xu(a,`${i} has member 'mode' that`)}}function xu(e,i){if(e=`${e}`,e!=="byob")throw new TypeError(`${i} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function ku(e,i){var a;_e(e,i);let u=(a=e?.min)!==null&&a!==void 0?a:1;return{min:In(u,`${i} has member 'min' that`)}}function $s(e){return new $e(e)}function js(e,i){e._reader._readIntoRequests.push(i)}function Pu(e,i,a){let f=e._reader._readIntoRequests.shift();a?f._closeSteps(i):f._chunkSteps(i)}function zs(e){return e._reader._readIntoRequests.length}function Jn(e){let i=e._reader;return!(i===void 0||!it(i))}class $e{constructor(i){if(Te(i,1,"ReadableStreamBYOBReader"),Dn(i,"First parameter"),Ve(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!rt(i._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");ds(this,i),this._readIntoRequests=new W}get closed(){return it(this)?this._closedPromise:h(Tr("closed"))}cancel(i=void 0){return it(this)?this._ownerReadableStream===void 0?h(br("cancel")):An(this,i):h(Tr("cancel"))}read(i,a={}){if(!it(this))return h(Tr("read"));if(!ArrayBuffer.isView(i))return h(new TypeError("view must be an array buffer view"));if(i.byteLength===0)return h(new TypeError("view must have non-zero byteLength"));if(i.buffer.byteLength===0)return h(new TypeError("view's buffer must have non-zero byteLength"));if(Ne(i.buffer))return h(new TypeError("view's buffer has been detached"));let u;try{u=ku(a,"options")}catch(E){return h(E)}let f=u.min;if(f===0)return h(new TypeError("options.min must be greater than 0"));if(_u(i)){if(f>i.byteLength)return h(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(f>i.length)return h(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return h(br("read from"));let m,b,S=p((E,x)=>{m=E,b=x});return Vs(this,i,f,{_chunkSteps:E=>m({value:E,done:!1}),_closeSteps:E=>m({value:E,done:!0}),_errorSteps:E=>b(E)}),S}releaseLock(){if(!it(this))throw Tr("releaseLock");this._ownerReadableStream!==void 0&&Au(this)}}Object.defineProperties($e.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o($e.prototype.cancel,"cancel"),o($e.prototype.read,"read"),o($e.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty($e.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function it(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof $e}function Vs(e,i,a,u){let f=e._ownerReadableStream;f._disturbed=!0,f._state==="errored"?u._errorSteps(f._storedError):Su(f._readableStreamController,i,a,u)}function Au(e){Re(e);let i=new TypeError("Reader was released");Hs(e,i)}function Hs(e,i){let a=e._readIntoRequests;e._readIntoRequests=new W,a.forEach(u=>{u._errorSteps(i)})}function Tr(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function Nt(e,i){let{highWaterMark:a}=e;if(a===void 0)return i;if(Ts(a)||a<0)throw new RangeError("Invalid highWaterMark");return a}function Cr(e){let{size:i}=e;return i||(()=>1)}function xr(e,i){_e(e,i);let a=e?.highWaterMark,u=e?.size;return{highWaterMark:a===void 0?void 0:Ln(a),size:u===void 0?void 0:Ou(u,`${i} has member 'size' that`)}}function Ou(e,i){return ie(e,i),a=>Ln(e(a))}function Bu(e,i){_e(e,i);let a=e?.abort,u=e?.close,f=e?.start,m=e?.type,b=e?.write;return{abort:a===void 0?void 0:Wu(a,e,`${i} has member 'abort' that`),close:u===void 0?void 0:Lu(u,e,`${i} has member 'close' that`),start:f===void 0?void 0:Iu(f,e,`${i} has member 'start' that`),write:b===void 0?void 0:Du(b,e,`${i} has member 'write' that`),type:m}}function Wu(e,i,a){return ie(e,a),u=>F(e,i,[u])}function Lu(e,i,a){return ie(e,a),()=>F(e,i,[])}function Iu(e,i,a){return ie(e,a),u=>L(e,i,[u])}function Du(e,i,a){return ie(e,a),(u,f)=>F(e,i,[u,f])}function Gs(e,i){if(!gt(e))throw new TypeError(`${i} is not a WritableStream.`)}function qu(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}let Uu=typeof AbortController=="function";function Fu(){if(Uu)return new AbortController}class je{constructor(i={},a={}){i===void 0?i=null:bs(i,"First parameter");let u=xr(a,"Second parameter"),f=Bu(i,"First parameter");if(Qs(this),f.type!==void 0)throw new RangeError("Invalid type is specified");let b=Cr(u),S=Nt(u,1);Zu(this,f,S,b)}get locked(){if(!gt(this))throw Br("locked");return St(this)}abort(i=void 0){return gt(this)?St(this)?h(new TypeError("Cannot abort a stream that already has a writer")):kr(this,i):h(Br("abort"))}close(){return gt(this)?St(this)?h(new TypeError("Cannot close a stream that already has a writer")):ye(this)?h(new TypeError("Cannot close an already-closing stream")):Js(this):h(Br("close"))}getWriter(){if(!gt(this))throw Br("getWriter");return Ys(this)}}Object.defineProperties(je.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),o(je.prototype.abort,"abort"),o(je.prototype.close,"close"),o(je.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(je.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Ys(e){return new ke(e)}function Nu(e,i,a,u,f=1,m=()=>1){let b=Object.create(je.prototype);Qs(b);let S=Object.create(wt.prototype);return ro(b,S,e,i,a,u,f,m),b}function Qs(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new W,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function gt(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof je}function St(e){return e._writer!==void 0}function kr(e,i){var a;if(e._state==="closed"||e._state==="errored")return d(void 0);e._writableStreamController._abortReason=i,(a=e._writableStreamController._abortController)===null||a===void 0||a.abort(i);let u=e._state;if(u==="closed"||u==="errored")return d(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let f=!1;u==="erroring"&&(f=!0,i=void 0);let m=p((b,S)=>{e._pendingAbortRequest={_promise:void 0,_resolve:b,_reject:S,_reason:i,_wasAlreadyErroring:f}});return e._pendingAbortRequest._promise=m,f||Xn(e,i),m}function Js(e){let i=e._state;if(i==="closed"||i==="errored")return h(new TypeError(`The stream (in ${i} state) is not in the writable state and cannot be closed`));let a=p((f,m)=>{let b={_resolve:f,_reject:m};e._closeRequest=b}),u=e._writer;return u!==void 0&&e._backpressure&&i==="writable"&&oi(u),ec(e._writableStreamController),a}function Mu(e){return p((a,u)=>{let f={_resolve:a,_reject:u};e._writeRequests.push(f)})}function Kn(e,i){if(e._state==="writable"){Xn(e,i);return}Zn(e)}function Xn(e,i){let a=e._writableStreamController;e._state="erroring",e._storedError=i;let u=e._writer;u!==void 0&&Xs(u,i),!Hu(e)&&a._started&&Zn(e)}function Zn(e){e._state="errored",e._writableStreamController[ue]();let i=e._storedError;if(e._writeRequests.forEach(f=>{f._reject(i)}),e._writeRequests=new W,e._pendingAbortRequest===void 0){Pr(e);return}let a=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,a._wasAlreadyErroring){a._reject(i),Pr(e);return}let u=e._writableStreamController[I](a._reason);v(u,()=>(a._resolve(),Pr(e),null),f=>(a._reject(f),Pr(e),null))}function $u(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function ju(e,i){e._inFlightWriteRequest._reject(i),e._inFlightWriteRequest=void 0,Kn(e,i)}function zu(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let a=e._writer;a!==void 0&&oo(a)}function Vu(e,i){e._inFlightCloseRequest._reject(i),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(i),e._pendingAbortRequest=void 0),Kn(e,i)}function ye(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function Hu(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function Gu(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Yu(e){e._inFlightWriteRequest=e._writeRequests.shift()}function Pr(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let i=e._writer;i!==void 0&&ii(i,e._storedError)}function ei(e,i){let a=e._writer;a!==void 0&&i!==e._backpressure&&(i?ac(a):oi(a)),e._backpressure=i}class ke{constructor(i){if(Te(i,1,"WritableStreamDefaultWriter"),Gs(i,"First parameter"),St(i))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=i,i._writer=this;let a=i._state;if(a==="writable")!ye(i)&&i._backpressure?Lr(this):ao(this),Wr(this);else if(a==="erroring")si(this,i._storedError),Wr(this);else if(a==="closed")ao(this),sc(this);else{let u=i._storedError;si(this,u),so(this,u)}}get closed(){return st(this)?this._closedPromise:h(ot("closed"))}get desiredSize(){if(!st(this))throw ot("desiredSize");if(this._ownerWritableStream===void 0)throw $t("desiredSize");return Xu(this)}get ready(){return st(this)?this._readyPromise:h(ot("ready"))}abort(i=void 0){return st(this)?this._ownerWritableStream===void 0?h($t("abort")):Qu(this,i):h(ot("abort"))}close(){if(!st(this))return h(ot("close"));let i=this._ownerWritableStream;return i===void 0?h($t("close")):ye(i)?h(new TypeError("Cannot close an already-closing stream")):Ks(this)}releaseLock(){if(!st(this))throw ot("releaseLock");this._ownerWritableStream!==void 0&&Zs(this)}write(i=void 0){return st(this)?this._ownerWritableStream===void 0?h($t("write to")):eo(this,i):h(ot("write"))}}Object.defineProperties(ke.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),o(ke.prototype.abort,"abort"),o(ke.prototype.close,"close"),o(ke.prototype.releaseLock,"releaseLock"),o(ke.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ke.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function st(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof ke}function Qu(e,i){let a=e._ownerWritableStream;return kr(a,i)}function Ks(e){let i=e._ownerWritableStream;return Js(i)}function Ju(e){let i=e._ownerWritableStream,a=i._state;return ye(i)||a==="closed"?d(void 0):a==="errored"?h(i._storedError):Ks(e)}function Ku(e,i){e._closedPromiseState==="pending"?ii(e,i):oc(e,i)}function Xs(e,i){e._readyPromiseState==="pending"?lo(e,i):lc(e,i)}function Xu(e){let i=e._ownerWritableStream,a=i._state;return a==="errored"||a==="erroring"?null:a==="closed"?0:no(i._writableStreamController)}function Zs(e){let i=e._ownerWritableStream,a=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Xs(e,a),Ku(e,a),i._writer=void 0,e._ownerWritableStream=void 0}function eo(e,i){let a=e._ownerWritableStream,u=a._writableStreamController,f=tc(u,i);if(a!==e._ownerWritableStream)return h($t("write to"));let m=a._state;if(m==="errored")return h(a._storedError);if(ye(a)||m==="closed")return h(new TypeError("The stream is closing or closed and cannot be written to"));if(m==="erroring")return h(a._storedError);let b=Mu(a);return rc(u,i,f),b}let to={};class wt{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!ti(this))throw ni("abortReason");return this._abortReason}get signal(){if(!ti(this))throw ni("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(i=void 0){if(!ti(this))throw ni("error");this._controlledWritableStream._state==="writable"&&io(this,i)}[I](i){let a=this._abortAlgorithm(i);return Ar(this),a}[ue](){Me(this)}}Object.defineProperties(wt.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(wt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function ti(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof wt}function ro(e,i,a,u,f,m,b,S){i._controlledWritableStream=e,e._writableStreamController=i,i._queue=void 0,i._queueTotalSize=void 0,Me(i),i._abortReason=void 0,i._abortController=Fu(),i._started=!1,i._strategySizeAlgorithm=S,i._strategyHWM=b,i._writeAlgorithm=u,i._closeAlgorithm=f,i._abortAlgorithm=m;let C=ri(i);ei(e,C);let E=a(),x=d(E);v(x,()=>(i._started=!0,Or(i),null),A=>(i._started=!0,Kn(e,A),null))}function Zu(e,i,a,u){let f=Object.create(wt.prototype),m,b,S,C;i.start!==void 0?m=()=>i.start(f):m=()=>{},i.write!==void 0?b=E=>i.write(E,f):b=()=>d(void 0),i.close!==void 0?S=()=>i.close():S=()=>d(void 0),i.abort!==void 0?C=E=>i.abort(E):C=()=>d(void 0),ro(e,f,m,b,S,C,a,u)}function Ar(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function ec(e){jn(e,to,0),Or(e)}function tc(e,i){try{return e._strategySizeAlgorithm(i)}catch(a){return Mt(e,a),1}}function no(e){return e._strategyHWM-e._queueTotalSize}function rc(e,i,a){try{jn(e,i,a)}catch(f){Mt(e,f);return}let u=e._controlledWritableStream;if(!ye(u)&&u._state==="writable"){let f=ri(e);ei(u,f)}Or(e)}function Or(e){let i=e._controlledWritableStream;if(!e._started||i._inFlightWriteRequest!==void 0)return;if(i._state==="erroring"){Zn(i);return}if(e._queue.length===0)return;let u=bu(e);u===to?nc(e):ic(e,u)}function Mt(e,i){e._controlledWritableStream._state==="writable"&&io(e,i)}function nc(e){let i=e._controlledWritableStream;Gu(i),$n(e);let a=e._closeAlgorithm();Ar(e),v(a,()=>(zu(i),null),u=>(Vu(i,u),null))}function ic(e,i){let a=e._controlledWritableStream;Yu(a);let u=e._writeAlgorithm(i);v(u,()=>{$u(a);let f=a._state;if($n(e),!ye(a)&&f==="writable"){let m=ri(e);ei(a,m)}return Or(e),null},f=>(a._state==="writable"&&Ar(e),ju(a,f),null))}function ri(e){return no(e)<=0}function io(e,i){let a=e._controlledWritableStream;Ar(e),Xn(a,i)}function Br(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function ni(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function ot(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function $t(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function Wr(e){e._closedPromise=p((i,a)=>{e._closedPromise_resolve=i,e._closedPromise_reject=a,e._closedPromiseState="pending"})}function so(e,i){Wr(e),ii(e,i)}function sc(e){Wr(e),oo(e)}function ii(e,i){e._closedPromise_reject!==void 0&&(T(e._closedPromise),e._closedPromise_reject(i),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function oc(e,i){so(e,i)}function oo(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function Lr(e){e._readyPromise=p((i,a)=>{e._readyPromise_resolve=i,e._readyPromise_reject=a}),e._readyPromiseState="pending"}function si(e,i){Lr(e),lo(e,i)}function ao(e){Lr(e),oi(e)}function lo(e,i){e._readyPromise_reject!==void 0&&(T(e._readyPromise),e._readyPromise_reject(i),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function ac(e){Lr(e)}function lc(e,i){si(e,i)}function oi(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}function uc(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let ai=uc();function cc(e){if(!(typeof e=="function"||typeof e=="object")||e.name!=="DOMException")return!1;try{return new e,!0}catch{return!1}}function fc(){let e=ai?.DOMException;return cc(e)?e:void 0}function dc(){let e=function(a,u){this.message=a||"",this.name=u||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return o(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}let hc=fc()||dc();function uo(e,i,a,u,f,m){let b=_t(e),S=Ys(i);e._disturbed=!0;let C=!1,E=d(void 0);return p((x,A)=>{let D;if(m!==void 0){if(D=()=>{let R=m.reason!==void 0?m.reason:new hc("Aborted","AbortError"),B=[];u||B.push(()=>i._state==="writable"?kr(i,R):d(void 0)),f||B.push(()=>e._state==="readable"?fe(e,R):d(void 0)),J(()=>Promise.all(B.map(q=>q())),!0,R)},m.aborted){D();return}m.addEventListener("abort",D)}function de(){return p((R,B)=>{function q(Z){Z?R():g(Tt(),q,B)}q(!1)})}function Tt(){return C?d(!0):g(S._readyPromise,()=>p((R,B)=>{Dt(b,{_chunkSteps:q=>{E=g(eo(S,q),void 0,t),R(!1)},_closeSteps:()=>R(!0),_errorSteps:B})}))}if(Ae(e,b._closedPromise,R=>(u?oe(!0,R):J(()=>kr(i,R),!0,R),null)),Ae(i,S._closedPromise,R=>(f?oe(!0,R):J(()=>fe(e,R),!0,R),null)),G(e,b._closedPromise,()=>(a?oe():J(()=>Ju(S)),null)),ye(i)||i._state==="closed"){let R=new TypeError("the destination writable stream closed before all data could be piped to it");f?oe(!0,R):J(()=>fe(e,R),!0,R)}T(de());function Ge(){let R=E;return g(E,()=>R!==E?Ge():void 0)}function Ae(R,B,q){R._state==="errored"?q(R._storedError):y(B,q)}function G(R,B,q){R._state==="closed"?q():P(B,q)}function J(R,B,q){if(C)return;C=!0,i._state==="writable"&&!ye(i)?P(Ge(),Z):Z();function Z(){return v(R(),()=>Oe(B,q),Ct=>Oe(!0,Ct)),null}}function oe(R,B){C||(C=!0,i._state==="writable"&&!ye(i)?P(Ge(),()=>Oe(R,B)):Oe(R,B))}function Oe(R,B){return Zs(S),Re(b),m!==void 0&&m.removeEventListener("abort",D),R?A(B):x(void 0),null}})}class Pe{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Ir(this))throw qr("desiredSize");return li(this)}close(){if(!Ir(this))throw qr("close");if(!Et(this))throw new TypeError("The stream is not in a state that permits close");at(this)}enqueue(i=void 0){if(!Ir(this))throw qr("enqueue");if(!Et(this))throw new TypeError("The stream is not in a state that permits enqueue");return vt(this,i)}error(i=void 0){if(!Ir(this))throw qr("error");ce(this,i)}[Ee](i){Me(this);let a=this._cancelAlgorithm(i);return Dr(this),a}[It](i){let a=this._controlledReadableStream;if(this._queue.length>0){let u=$n(this);this._closeRequested&&this._queue.length===0?(Dr(this),Vt(a)):jt(this),i._chunkSteps(u)}else ys(a,i),jt(this)}[Pn](){}}Object.defineProperties(Pe.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),o(Pe.prototype.close,"close"),o(Pe.prototype.enqueue,"enqueue"),o(Pe.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Pe.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Ir(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof Pe}function jt(e){if(!co(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let a=e._pullAlgorithm();v(a,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,jt(e)),null),u=>(ce(e,u),null))}function co(e){let i=e._controlledReadableStream;return!Et(e)||!e._started?!1:!!(Ve(i)&&_r(i)>0||li(e)>0)}function Dr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function at(e){if(!Et(e))return;let i=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(Dr(e),Vt(i))}function vt(e,i){if(!Et(e))return;let a=e._controlledReadableStream;if(Ve(a)&&_r(a)>0)qn(a,i,!1);else{let u;try{u=e._strategySizeAlgorithm(i)}catch(f){throw ce(e,f),f}try{jn(e,i,u)}catch(f){throw ce(e,f),f}}jt(e)}function ce(e,i){let a=e._controlledReadableStream;a._state==="readable"&&(Me(e),Dr(e),mo(a,i))}function li(e){let i=e._controlledReadableStream._state;return i==="errored"?null:i==="closed"?0:e._strategyHWM-e._queueTotalSize}function pc(e){return!co(e)}function Et(e){let i=e._controlledReadableStream._state;return!e._closeRequested&&i==="readable"}function fo(e,i,a,u,f,m,b){i._controlledReadableStream=e,i._queue=void 0,i._queueTotalSize=void 0,Me(i),i._started=!1,i._closeRequested=!1,i._pullAgain=!1,i._pulling=!1,i._strategySizeAlgorithm=b,i._strategyHWM=m,i._pullAlgorithm=u,i._cancelAlgorithm=f,e._readableStreamController=i;let S=a();v(d(S),()=>(i._started=!0,jt(i),null),C=>(ce(i,C),null))}function mc(e,i,a,u){let f=Object.create(Pe.prototype),m,b,S;i.start!==void 0?m=()=>i.start(f):m=()=>{},i.pull!==void 0?b=()=>i.pull(f):b=()=>d(void 0),i.cancel!==void 0?S=C=>i.cancel(C):S=()=>d(void 0),fo(e,f,m,b,S,a,u)}function qr(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function bc(e,i){return rt(e._readableStreamController)?yc(e):_c(e)}function _c(e,i){let a=_t(e),u=!1,f=!1,m=!1,b=!1,S,C,E,x,A,D=p(G=>{A=G});function de(){return u?(f=!0,d(void 0)):(u=!0,Dt(a,{_chunkSteps:J=>{k(()=>{f=!1;let oe=J,Oe=J;m||vt(E._readableStreamController,oe),b||vt(x._readableStreamController,Oe),u=!1,f&&de()})},_closeSteps:()=>{u=!1,m||at(E._readableStreamController),b||at(x._readableStreamController),(!m||!b)&&A(void 0)},_errorSteps:()=>{u=!1}}),d(void 0))}function Tt(G){if(m=!0,S=G,b){let J=qt([S,C]),oe=fe(e,J);A(oe)}return D}function Ge(G){if(b=!0,C=G,m){let J=qt([S,C]),oe=fe(e,J);A(oe)}return D}function Ae(){}return E=zt(Ae,de,Tt),x=zt(Ae,de,Ge),y(a._closedPromise,G=>(ce(E._readableStreamController,G),ce(x._readableStreamController,G),(!m||!b)&&A(void 0),null)),[E,x]}function yc(e){let i=_t(e),a=!1,u=!1,f=!1,m=!1,b=!1,S,C,E,x,A,D=p(R=>{A=R});function de(R){y(R._closedPromise,B=>(R!==i||(se(E._readableStreamController,B),se(x._readableStreamController,B),(!m||!b)&&A(void 0)),null))}function Tt(){it(i)&&(Re(i),i=_t(e),de(i)),Dt(i,{_chunkSteps:B=>{k(()=>{u=!1,f=!1;let q=B,Z=B;if(!m&&!b)try{Z=Ps(B)}catch(Ct){se(E._readableStreamController,Ct),se(x._readableStreamController,Ct),A(fe(e,Ct));return}m||vr(E._readableStreamController,q),b||vr(x._readableStreamController,Z),a=!1,u?Ae():f&&G()})},_closeSteps:()=>{a=!1,m||Ut(E._readableStreamController),b||Ut(x._readableStreamController),E._readableStreamController._pendingPullIntos.length>0&&Er(E._readableStreamController,0),x._readableStreamController._pendingPullIntos.length>0&&Er(x._readableStreamController,0),(!m||!b)&&A(void 0)},_errorSteps:()=>{a=!1}})}function Ge(R,B){Fe(i)&&(Re(i),i=$s(e),de(i));let q=B?x:E,Z=B?E:x;Vs(i,R,1,{_chunkSteps:xt=>{k(()=>{u=!1,f=!1;let kt=B?b:m;if(B?m:b)kt||Rr(q._readableStreamController,xt);else{let ko;try{ko=Ps(xt)}catch(hi){se(q._readableStreamController,hi),se(Z._readableStreamController,hi),A(fe(e,hi));return}kt||Rr(q._readableStreamController,xt),vr(Z._readableStreamController,ko)}a=!1,u?Ae():f&&G()})},_closeSteps:xt=>{a=!1;let kt=B?b:m,Vr=B?m:b;kt||Ut(q._readableStreamController),Vr||Ut(Z._readableStreamController),xt!==void 0&&(kt||Rr(q._readableStreamController,xt),!Vr&&Z._readableStreamController._pendingPullIntos.length>0&&Er(Z._readableStreamController,0)),(!kt||!Vr)&&A(void 0)},_errorSteps:()=>{a=!1}})}function Ae(){if(a)return u=!0,d(void 0);a=!0;let R=Yn(E._readableStreamController);return R===null?Tt():Ge(R._view,!1),d(void 0)}function G(){if(a)return f=!0,d(void 0);a=!0;let R=Yn(x._readableStreamController);return R===null?Tt():Ge(R._view,!0),d(void 0)}function J(R){if(m=!0,S=R,b){let B=qt([S,C]),q=fe(e,B);A(q)}return D}function oe(R){if(b=!0,C=R,m){let B=qt([S,C]),q=fe(e,B);A(q)}return D}function Oe(){}return E=po(Oe,Ae,J),x=po(Oe,G,oe),de(i),[E,x]}function gc(e){return r(e)&&typeof e.getReader<"u"}function Sc(e){return gc(e)?vc(e.getReader()):wc(e)}function wc(e){let i,a=ks(e,"async"),u=t;function f(){let b;try{b=du(a)}catch(C){return h(C)}let S=d(b);return w(S,C=>{if(!r(C))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(hu(C))at(i._readableStreamController);else{let x=pu(C);vt(i._readableStreamController,x)}})}function m(b){let S=a.iterator,C;try{C=gr(S,"return")}catch(A){return h(A)}if(C===void 0)return d(void 0);let E;try{E=L(C,S,[b])}catch(A){return h(A)}let x=d(E);return w(x,A=>{if(!r(A))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return i=zt(u,f,m,0),i}function vc(e){let i,a=t;function u(){let m;try{m=e.read()}catch(b){return h(b)}return w(m,b=>{if(!r(b))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(b.done)at(i._readableStreamController);else{let S=b.value;vt(i._readableStreamController,S)}})}function f(m){try{return d(e.cancel(m))}catch(b){return h(b)}}return i=zt(a,u,f,0),i}function Ec(e,i){_e(e,i);let a=e,u=a?.autoAllocateChunkSize,f=a?.cancel,m=a?.pull,b=a?.start,S=a?.type;return{autoAllocateChunkSize:u===void 0?void 0:In(u,`${i} has member 'autoAllocateChunkSize' that`),cancel:f===void 0?void 0:Rc(f,a,`${i} has member 'cancel' that`),pull:m===void 0?void 0:Tc(m,a,`${i} has member 'pull' that`),start:b===void 0?void 0:Cc(b,a,`${i} has member 'start' that`),type:S===void 0?void 0:xc(S,`${i} has member 'type' that`)}}function Rc(e,i,a){return ie(e,a),u=>F(e,i,[u])}function Tc(e,i,a){return ie(e,a),u=>F(e,i,[u])}function Cc(e,i,a){return ie(e,a),u=>L(e,i,[u])}function xc(e,i){if(e=`${e}`,e!=="bytes")throw new TypeError(`${i} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function kc(e,i){return _e(e,i),{preventCancel:!!e?.preventCancel}}function ho(e,i){_e(e,i);let a=e?.preventAbort,u=e?.preventCancel,f=e?.preventClose,m=e?.signal;return m!==void 0&&Pc(m,`${i} has member 'signal' that`),{preventAbort:!!a,preventCancel:!!u,preventClose:!!f,signal:m}}function Pc(e,i){if(!qu(e))throw new TypeError(`${i} is not an AbortSignal.`)}function Ac(e,i){_e(e,i);let a=e?.readable;Wn(a,"readable","ReadableWritablePair"),Dn(a,`${i} has member 'readable' that`);let u=e?.writable;return Wn(u,"writable","ReadableWritablePair"),Gs(u,`${i} has member 'writable' that`),{readable:a,writable:u}}class z{constructor(i={},a={}){i===void 0?i=null:bs(i,"First parameter");let u=xr(a,"Second parameter"),f=Ec(i,"First parameter");if(ui(this),f.type==="bytes"){if(u.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let m=Nt(u,0);Ru(this,f,m)}else{let m=Cr(u),b=Nt(u,1);mc(this,f,b,m)}}get locked(){if(!ze(this))throw lt("locked");return Ve(this)}cancel(i=void 0){return ze(this)?Ve(this)?h(new TypeError("Cannot cancel a stream that already has a reader")):fe(this,i):h(lt("cancel"))}getReader(i=void 0){if(!ze(this))throw lt("getReader");return Cu(i,"First parameter").mode===void 0?_t(this):$s(this)}pipeThrough(i,a={}){if(!ze(this))throw lt("pipeThrough");Te(i,1,"pipeThrough");let u=Ac(i,"First parameter"),f=ho(a,"Second parameter");if(Ve(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(St(u.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let m=uo(this,u.writable,f.preventClose,f.preventAbort,f.preventCancel,f.signal);return T(m),u.readable}pipeTo(i,a={}){if(!ze(this))return h(lt("pipeTo"));if(i===void 0)return h("Parameter 1 is required in 'pipeTo'.");if(!gt(i))return h(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let u;try{u=ho(a,"Second parameter")}catch(f){return h(f)}return Ve(this)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):St(i)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):uo(this,i,u.preventClose,u.preventAbort,u.preventCancel,u.signal)}tee(){if(!ze(this))throw lt("tee");let i=bc(this);return qt(i)}values(i=void 0){if(!ze(this))throw lt("values");let a=kc(i,"First parameter");return cu(this,a.preventCancel)}[Mn](i){return this.values(i)}static from(i){return Sc(i)}}Object.defineProperties(z,{from:{enumerable:!0}}),Object.defineProperties(z.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),o(z.from,"from"),o(z.prototype.cancel,"cancel"),o(z.prototype.getReader,"getReader"),o(z.prototype.pipeThrough,"pipeThrough"),o(z.prototype.pipeTo,"pipeTo"),o(z.prototype.tee,"tee"),o(z.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(z.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(z.prototype,Mn,{value:z.prototype.values,writable:!0,configurable:!0});function zt(e,i,a,u=1,f=()=>1){let m=Object.create(z.prototype);ui(m);let b=Object.create(Pe.prototype);return fo(m,b,e,i,a,u,f),m}function po(e,i,a){let u=Object.create(z.prototype);ui(u);let f=Object.create(xe.prototype);return Ms(u,f,e,i,a,0,void 0),u}function ui(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function ze(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof z}function Ve(e){return e._reader!==void 0}function fe(e,i){if(e._disturbed=!0,e._state==="closed")return d(void 0);if(e._state==="errored")return h(e._storedError);Vt(e);let a=e._reader;if(a!==void 0&&it(a)){let f=a._readIntoRequests;a._readIntoRequests=new W,f.forEach(m=>{m._closeSteps(void 0)})}let u=e._readableStreamController[Ee](i);return w(u,t)}function Vt(e){e._state="closed";let i=e._reader;if(i!==void 0&&(ps(i),Fe(i))){let a=i._readRequests;i._readRequests=new W,a.forEach(u=>{u._closeSteps()})}}function mo(e,i){e._state="errored",e._storedError=i;let a=e._reader;a!==void 0&&(Bn(a,i),Fe(a)?Ss(a,i):Hs(a,i))}function lt(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function bo(e,i){_e(e,i);let a=e?.highWaterMark;return Wn(a,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Ln(a)}}let _o=e=>e.byteLength;o(_o,"size");class Ur{constructor(i){Te(i,1,"ByteLengthQueuingStrategy"),i=bo(i,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!go(this))throw yo("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!go(this))throw yo("size");return _o}}Object.defineProperties(Ur.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ur.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function yo(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function go(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof Ur}let So=()=>1;o(So,"size");class Fr{constructor(i){Te(i,1,"CountQueuingStrategy"),i=bo(i,"First parameter"),this._countQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!vo(this))throw wo("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!vo(this))throw wo("size");return So}}Object.defineProperties(Fr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Fr.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function wo(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function vo(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof Fr}function Oc(e,i){_e(e,i);let a=e?.cancel,u=e?.flush,f=e?.readableType,m=e?.start,b=e?.transform,S=e?.writableType;return{cancel:a===void 0?void 0:Ic(a,e,`${i} has member 'cancel' that`),flush:u===void 0?void 0:Bc(u,e,`${i} has member 'flush' that`),readableType:f,start:m===void 0?void 0:Wc(m,e,`${i} has member 'start' that`),transform:b===void 0?void 0:Lc(b,e,`${i} has member 'transform' that`),writableType:S}}function Bc(e,i,a){return ie(e,a),u=>F(e,i,[u])}function Wc(e,i,a){return ie(e,a),u=>L(e,i,[u])}function Lc(e,i,a){return ie(e,a),(u,f)=>F(e,i,[u,f])}function Ic(e,i,a){return ie(e,a),u=>F(e,i,[u])}class Nr{constructor(i={},a={},u={}){i===void 0&&(i=null);let f=xr(a,"Second parameter"),m=xr(u,"Third parameter"),b=Oc(i,"First parameter");if(b.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(b.writableType!==void 0)throw new RangeError("Invalid writableType specified");let S=Nt(m,0),C=Cr(m),E=Nt(f,1),x=Cr(f),A,D=p(de=>{A=de});Dc(this,D,E,x,S,C),Uc(this,b),b.start!==void 0?A(b.start(this._transformStreamController)):A(void 0)}get readable(){if(!Eo(this))throw xo("readable");return this._readable}get writable(){if(!Eo(this))throw xo("writable");return this._writable}}Object.defineProperties(Nr.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Nr.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function Dc(e,i,a,u,f,m){function b(){return i}function S(D){return Mc(e,D)}function C(D){return $c(e,D)}function E(){return jc(e)}e._writable=Nu(b,S,E,C,a,u);function x(){return zc(e)}function A(D){return Vc(e,D)}e._readable=zt(b,x,A,f,m),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,Mr(e,!0),e._transformStreamController=void 0}function Eo(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof Nr}function Ro(e,i){ce(e._readable._readableStreamController,i),ci(e,i)}function ci(e,i){jr(e._transformStreamController),Mt(e._writable._writableStreamController,i),fi(e)}function fi(e){e._backpressure&&Mr(e,!1)}function Mr(e,i){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=p(a=>{e._backpressureChangePromise_resolve=a}),e._backpressure=i}class He{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!$r(this))throw zr("desiredSize");let i=this._controlledTransformStream._readable._readableStreamController;return li(i)}enqueue(i=void 0){if(!$r(this))throw zr("enqueue");To(this,i)}error(i=void 0){if(!$r(this))throw zr("error");Fc(this,i)}terminate(){if(!$r(this))throw zr("terminate");Nc(this)}}Object.defineProperties(He.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),o(He.prototype.enqueue,"enqueue"),o(He.prototype.error,"error"),o(He.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(He.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function $r(e){return!r(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof He}function qc(e,i,a,u,f){i._controlledTransformStream=e,e._transformStreamController=i,i._transformAlgorithm=a,i._flushAlgorithm=u,i._cancelAlgorithm=f,i._finishPromise=void 0,i._finishPromise_resolve=void 0,i._finishPromise_reject=void 0}function Uc(e,i){let a=Object.create(He.prototype),u,f,m;i.transform!==void 0?u=b=>i.transform(b,a):u=b=>{try{return To(a,b),d(void 0)}catch(S){return h(S)}},i.flush!==void 0?f=()=>i.flush(a):f=()=>d(void 0),i.cancel!==void 0?m=b=>i.cancel(b):m=()=>d(void 0),qc(e,a,u,f,m)}function jr(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function To(e,i){let a=e._controlledTransformStream,u=a._readable._readableStreamController;if(!Et(u))throw new TypeError("Readable side is not in a state that permits enqueue");try{vt(u,i)}catch(m){throw ci(a,m),a._readable._storedError}pc(u)!==a._backpressure&&Mr(a,!0)}function Fc(e,i){Ro(e._controlledTransformStream,i)}function Co(e,i){let a=e._transformAlgorithm(i);return w(a,void 0,u=>{throw Ro(e._controlledTransformStream,u),u})}function Nc(e){let i=e._controlledTransformStream,a=i._readable._readableStreamController;at(a);let u=new TypeError("TransformStream terminated");ci(i,u)}function Mc(e,i){let a=e._transformStreamController;if(e._backpressure){let u=e._backpressureChangePromise;return w(u,()=>{let f=e._writable;if(f._state==="erroring")throw f._storedError;return Co(a,i)})}return Co(a,i)}function $c(e,i){let a=e._transformStreamController;if(a._finishPromise!==void 0)return a._finishPromise;let u=e._readable;a._finishPromise=p((m,b)=>{a._finishPromise_resolve=m,a._finishPromise_reject=b});let f=a._cancelAlgorithm(i);return jr(a),v(f,()=>(u._state==="errored"?Rt(a,u._storedError):(ce(u._readableStreamController,i),di(a)),null),m=>(ce(u._readableStreamController,m),Rt(a,m),null)),a._finishPromise}function jc(e){let i=e._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let a=e._readable;i._finishPromise=p((f,m)=>{i._finishPromise_resolve=f,i._finishPromise_reject=m});let u=i._flushAlgorithm();return jr(i),v(u,()=>(a._state==="errored"?Rt(i,a._storedError):(at(a._readableStreamController),di(i)),null),f=>(ce(a._readableStreamController,f),Rt(i,f),null)),i._finishPromise}function zc(e){return Mr(e,!1),e._backpressureChangePromise}function Vc(e,i){let a=e._transformStreamController;if(a._finishPromise!==void 0)return a._finishPromise;let u=e._writable;a._finishPromise=p((m,b)=>{a._finishPromise_resolve=m,a._finishPromise_reject=b});let f=a._cancelAlgorithm(i);return jr(a),v(f,()=>(u._state==="errored"?Rt(a,u._storedError):(Mt(u._writableStreamController,i),fi(e),di(a)),null),m=>(Mt(u._writableStreamController,m),fi(e),Rt(a,m),null)),a._finishPromise}function zr(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function di(e){e._finishPromise_resolve!==void 0&&(e._finishPromise_resolve(),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function Rt(e,i){e._finishPromise_reject!==void 0&&(T(e._finishPromise),e._finishPromise_reject(i),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function xo(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}n.ByteLengthQueuingStrategy=Ur,n.CountQueuingStrategy=Fr,n.ReadableByteStreamController=xe,n.ReadableStream=z,n.ReadableStreamBYOBReader=$e,n.ReadableStreamBYOBRequest=tt,n.ReadableStreamDefaultController=Pe,n.ReadableStreamDefaultReader=Ue,n.TransformStream=Nr,n.TransformStreamDefaultController=He,n.WritableStream=je,n.WritableStreamDefaultController=wt,n.WritableStreamDefaultWriter=ke})});var dl=N(()=>{if(!globalThis.ReadableStream)try{let n=require("node:process"),{emitWarning:t}=n;try{n.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),n.emitWarning=t}catch(r){throw n.emitWarning=t,r}}catch{Object.assign(globalThis,fl())}try{let{Blob:n}=require("buffer");n&&!n.prototype.stream&&(n.prototype.stream=function(r){let s=0,o=this;return new ReadableStream({type:"bytes",async pull(l){let _=await o.slice(s,Math.min(o.size,s+65536)).arrayBuffer();s+=_.byteLength,l.enqueue(new Uint8Array(_)),s===o.size&&l.close()}})})}catch{}});async function*Ji(n,t=!0){for(let r of n)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(t){let s=r.byteOffset,o=r.byteOffset+r.byteLength;for(;s!==o;){let l=Math.min(o-s,hl),c=r.buffer.slice(s,s+l);s+=c.byteLength,yield new Uint8Array(c)}}else yield r;else{let s=0,o=r;for(;s!==o.size;){let c=await o.slice(s,Math.min(o.size,s+hl)).arrayBuffer();s+=c.byteLength,yield new Uint8Array(c)}}}var tp,hl,pl,Cd,me,ar=$(()=>{tp=V(dl(),1);hl=65536;pl=class Ki{#e=[];#t="";#r=0;#n="transparent";constructor(t=[],r={}){if(typeof t!="object"||t===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof t[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof r!="object"&&typeof r!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");r===null&&(r={});let s=new TextEncoder;for(let l of t){let c;ArrayBuffer.isView(l)?c=new Uint8Array(l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)):l instanceof ArrayBuffer?c=new Uint8Array(l.slice(0)):l instanceof Ki?c=l:c=s.encode(`${l}`),this.#r+=ArrayBuffer.isView(c)?c.byteLength:c.size,this.#e.push(c)}this.#n=`${r.endings===void 0?"transparent":r.endings}`;let o=r.type===void 0?"":String(r.type);this.#t=/^[\x20-\x7E]*$/.test(o)?o:""}get size(){return this.#r}get type(){return this.#t}async text(){let t=new TextDecoder,r="";for await(let s of Ji(this.#e,!1))r+=t.decode(s,{stream:!0});return r+=t.decode(),r}async arrayBuffer(){let t=new Uint8Array(this.size),r=0;for await(let s of Ji(this.#e,!1))t.set(s,r),r+=s.length;return t.buffer}stream(){let t=Ji(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(r){let s=await t.next();s.done?r.close():r.enqueue(s.value)},async cancel(){await t.return()}})}slice(t=0,r=this.size,s=""){let{size:o}=this,l=t<0?Math.max(o+t,0):Math.min(t,o),c=r<0?Math.max(o+r,0):Math.min(r,o),_=Math.max(c-l,0),p=this.#e,d=[],h=0;for(let v of p){if(h>=_)break;let P=ArrayBuffer.isView(v)?v.byteLength:v.size;if(l&&P<=l)l-=P,c-=P;else{let y;ArrayBuffer.isView(v)?(y=v.subarray(l,Math.min(P,c)),h+=y.byteLength):(y=v.slice(l,Math.min(P,c)),h+=y.size),c-=P,d.push(y),l=0}}let g=new Ki([],{type:String(s).toLowerCase()});return g.#r=_,g.#e=d,g}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](t){return t&&typeof t=="object"&&typeof t.constructor=="function"&&(typeof t.stream=="function"||typeof t.arrayBuffer=="function")&&/^(Blob|File)$/.test(t[Symbol.toStringTag])}};Object.defineProperties(pl.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Cd=pl,me=Cd});var xd,kd,Ke,Xi=$(()=>{ar();xd=class extends me{#e=0;#t="";constructor(t,r,s={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(t,s),s===null&&(s={});let o=s.lastModified===void 0?Date.now():Number(s.lastModified);Number.isNaN(o)||(this.#e=o),this.#t=String(r)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](t){return!!t&&t instanceof me&&/^(File)$/.test(t[Symbol.toStringTag])}},kd=xd,Ke=kd});function _l(n,t=me){var r=`${ml()}${ml()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),s=[],o=`--${r}\r
Content-Disposition: form-data; name="`;return n.forEach((l,c)=>typeof l=="string"?s.push(o+Zi(c)+`"\r
\r
${l.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):s.push(o+Zi(c)+`"; filename="${Zi(l.name,1)}"\r
Content-Type: ${l.type||"application/octet-stream"}\r
\r
`,l,`\r
`)),s.push(`--${r}--`),new t(s,{type:"multipart/form-data; boundary="+r})}var lr,Pd,Ad,ml,Od,bl,Zi,ht,Xe,_n=$(()=>{ar();Xi();({toStringTag:lr,iterator:Pd,hasInstance:Ad}=Symbol),ml=Math.random,Od="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),bl=(n,t,r)=>(n+="",/^(Blob|File)$/.test(t&&t[lr])?[(r=r!==void 0?r+"":t[lr]=="File"?t.name:"blob",n),t.name!==r||t[lr]=="blob"?new Ke([t],r,t):t]:[n,t+""]),Zi=(n,t)=>(t?n:n.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),ht=(n,t,r)=>{if(t.length<r)throw new TypeError(`Failed to execute '${n}' on 'FormData': ${r} arguments required, but only ${t.length} present.`)},Xe=class{#e=[];constructor(...t){if(t.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[lr](){return"FormData"}[Pd](){return this.entries()}static[Ad](t){return t&&typeof t=="object"&&t[lr]==="FormData"&&!Od.some(r=>typeof t[r]!="function")}append(...t){ht("append",arguments,2),this.#e.push(bl(...t))}delete(t){ht("delete",arguments,1),t+="",this.#e=this.#e.filter(([r])=>r!==t)}get(t){ht("get",arguments,1),t+="";for(var r=this.#e,s=r.length,o=0;o<s;o++)if(r[o][0]===t)return r[o][1];return null}getAll(t,r){return ht("getAll",arguments,1),r=[],t+="",this.#e.forEach(s=>s[0]===t&&r.push(s[1])),r}has(t){return ht("has",arguments,1),t+="",this.#e.some(r=>r[0]===t)}forEach(t,r){ht("forEach",arguments,1);for(var[s,o]of this)t.call(r,o,s,this)}set(...t){ht("set",arguments,2);var r=[],s=!0;t=bl(...t),this.#e.forEach(o=>{o[0]===t[0]?s&&(s=!r.push(t)):r.push(o)}),s&&r.push(t),this.#e=r}*entries(){yield*this.#e}*keys(){for(var[t]of this)yield t}*values(){for(var[,t]of this)yield t}}});var De,yn=$(()=>{De=class extends Error{constructor(t,r){super(t),Error.captureStackTrace(this,this.constructor),this.type=r}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var Q,es=$(()=>{yn();Q=class extends De{constructor(t,r,s){super(t,r),s&&(this.code=this.errno=s.code,this.erroredSysCall=s.syscall)}}});var gn,ts,ur,yl,gl,Sl,Sn=$(()=>{gn=Symbol.toStringTag,ts=n=>typeof n=="object"&&typeof n.append=="function"&&typeof n.delete=="function"&&typeof n.get=="function"&&typeof n.getAll=="function"&&typeof n.has=="function"&&typeof n.set=="function"&&typeof n.sort=="function"&&n[gn]==="URLSearchParams",ur=n=>n&&typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&typeof n.constructor=="function"&&/^(Blob|File)$/.test(n[gn]),yl=n=>typeof n=="object"&&(n[gn]==="AbortSignal"||n[gn]==="EventTarget"),gl=(n,t)=>{let r=new URL(t).hostname,s=new URL(n).hostname;return r===s||r.endsWith(`.${s}`)},Sl=(n,t)=>{let r=new URL(t).protocol,s=new URL(n).protocol;return r===s}});var vl=N((pp,wl)=>{if(!globalThis.DOMException)try{let{MessageChannel:n}=require("worker_threads"),t=new n().port1,r=new ArrayBuffer;t.postMessage(r,[r,r])}catch(n){n.constructor.name==="DOMException"&&(globalThis.DOMException=n.constructor)}wl.exports=globalThis.DOMException});var pt,El,Rl,rs,Tl,Cl,xl,kl,Pl,Al,wn,ns=$(()=>{pt=require("node:fs"),El=require("node:path"),Rl=V(vl(),1);Xi();ar();({stat:rs}=pt.promises),Tl=(n,t)=>Pl((0,pt.statSync)(n),n,t),Cl=(n,t)=>rs(n).then(r=>Pl(r,n,t)),xl=(n,t)=>rs(n).then(r=>Al(r,n,t)),kl=(n,t)=>Al((0,pt.statSync)(n),n,t),Pl=(n,t,r="")=>new me([new wn({path:t,size:n.size,lastModified:n.mtimeMs,start:0})],{type:r}),Al=(n,t,r="")=>new Ke([new wn({path:t,size:n.size,lastModified:n.mtimeMs,start:0})],(0,El.basename)(t),{type:r,lastModified:n.mtimeMs}),wn=class n{#e;#t;constructor(t){this.#e=t.path,this.#t=t.start,this.size=t.size,this.lastModified=t.lastModified}slice(t,r){return new n({path:this.#e,lastModified:this.lastModified,size:r-t,start:this.#t+t})}async*stream(){let{mtimeMs:t}=await rs(this.#e);if(t>this.lastModified)throw new Rl.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,pt.createReadStream)(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var Bl={};pi(Bl,{toFormData:()=>Ud});function qd(n){let t=n.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;let r=t[2]||t[3]||"",s=r.slice(r.lastIndexOf("\\")+1);return s=s.replace(/%22/g,'"'),s=s.replace(/&#(\d{4});/g,(o,l)=>String.fromCharCode(l)),s}async function Ud(n,t){if(!/multipart/i.test(t))throw new TypeError("Failed to fetch");let r=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!r)throw new TypeError("no or bad content-type header, no multipart boundary");let s=new is(r[1]||r[2]),o,l,c,_,p,d,h=[],g=new Xe,v=k=>{c+=T.decode(k,{stream:!0})},P=k=>{h.push(k)},y=()=>{let k=new Ke(h,d,{type:p});g.append(_,k)},w=()=>{g.append(_,c)},T=new TextDecoder("utf-8");T.decode(),s.onPartBegin=function(){s.onPartData=v,s.onPartEnd=w,o="",l="",c="",_="",p="",d=null,h.length=0},s.onHeaderField=function(k){o+=T.decode(k,{stream:!0})},s.onHeaderValue=function(k){l+=T.decode(k,{stream:!0})},s.onHeaderEnd=function(){if(l+=T.decode(),o=o.toLowerCase(),o==="content-disposition"){let k=l.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);k&&(_=k[2]||k[3]||""),d=qd(l),d&&(s.onPartData=P,s.onPartEnd=y)}else o==="content-type"&&(p=l);l="",o=""};for await(let k of n)s.write(k);return s.end(),g}var we,U,Ol,Ze,vn,En,Bd,cr,Wd,Ld,Id,Dd,mt,is,Wl=$(()=>{ns();_n();we=0,U={START_BOUNDARY:we++,HEADER_FIELD_START:we++,HEADER_FIELD:we++,HEADER_VALUE_START:we++,HEADER_VALUE:we++,HEADER_VALUE_ALMOST_DONE:we++,HEADERS_ALMOST_DONE:we++,PART_DATA_START:we++,PART_DATA:we++,END:we++},Ol=1,Ze={PART_BOUNDARY:Ol,LAST_BOUNDARY:Ol*=2},vn=10,En=13,Bd=32,cr=45,Wd=58,Ld=97,Id=122,Dd=n=>n|32,mt=()=>{},is=class{constructor(t){this.index=0,this.flags=0,this.onHeaderEnd=mt,this.onHeaderField=mt,this.onHeadersEnd=mt,this.onHeaderValue=mt,this.onPartBegin=mt,this.onPartData=mt,this.onPartEnd=mt,this.boundaryChars={},t=`\r
--`+t;let r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s),this.boundaryChars[r[s]]=!0;this.boundary=r,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=U.START_BOUNDARY}write(t){let r=0,s=t.length,o=this.index,{lookbehind:l,boundary:c,boundaryChars:_,index:p,state:d,flags:h}=this,g=this.boundary.length,v=g-1,P=t.length,y,w,T=O=>{this[O+"Mark"]=r},k=O=>{delete this[O+"Mark"]},L=(O,W,I,ue)=>{(W===void 0||W!==I)&&this[O](ue&&ue.subarray(W,I))},F=(O,W)=>{let I=O+"Mark";I in this&&(W?(L(O,this[I],r,t),delete this[I]):(L(O,this[I],t.length,t),this[I]=0))};for(r=0;r<s;r++)switch(y=t[r],d){case U.START_BOUNDARY:if(p===c.length-2){if(y===cr)h|=Ze.LAST_BOUNDARY;else if(y!==En)return;p++;break}else if(p-1===c.length-2){if(h&Ze.LAST_BOUNDARY&&y===cr)d=U.END,h=0;else if(!(h&Ze.LAST_BOUNDARY)&&y===vn)p=0,L("onPartBegin"),d=U.HEADER_FIELD_START;else return;break}y!==c[p+2]&&(p=-2),y===c[p+2]&&p++;break;case U.HEADER_FIELD_START:d=U.HEADER_FIELD,T("onHeaderField"),p=0;case U.HEADER_FIELD:if(y===En){k("onHeaderField"),d=U.HEADERS_ALMOST_DONE;break}if(p++,y===cr)break;if(y===Wd){if(p===1)return;F("onHeaderField",!0),d=U.HEADER_VALUE_START;break}if(w=Dd(y),w<Ld||w>Id)return;break;case U.HEADER_VALUE_START:if(y===Bd)break;T("onHeaderValue"),d=U.HEADER_VALUE;case U.HEADER_VALUE:y===En&&(F("onHeaderValue",!0),L("onHeaderEnd"),d=U.HEADER_VALUE_ALMOST_DONE);break;case U.HEADER_VALUE_ALMOST_DONE:if(y!==vn)return;d=U.HEADER_FIELD_START;break;case U.HEADERS_ALMOST_DONE:if(y!==vn)return;L("onHeadersEnd"),d=U.PART_DATA_START;break;case U.PART_DATA_START:d=U.PART_DATA,T("onPartData");case U.PART_DATA:if(o=p,p===0){for(r+=v;r<P&&!(t[r]in _);)r+=g;r-=v,y=t[r]}if(p<c.length)c[p]===y?(p===0&&F("onPartData",!0),p++):p=0;else if(p===c.length)p++,y===En?h|=Ze.PART_BOUNDARY:y===cr?h|=Ze.LAST_BOUNDARY:p=0;else if(p-1===c.length)if(h&Ze.PART_BOUNDARY){if(p=0,y===vn){h&=~Ze.PART_BOUNDARY,L("onPartEnd"),L("onPartBegin"),d=U.HEADER_FIELD_START;break}}else h&Ze.LAST_BOUNDARY&&y===cr?(L("onPartEnd"),d=U.END,h=0):p=0;if(p>0)l[p-1]=y;else if(o>0){let O=new Uint8Array(l.buffer,l.byteOffset,l.byteLength);L("onPartData",0,o,O),o=0,T("onPartData"),r--}break;case U.END:break;default:throw new Error(`Unexpected state entered: ${d}`)}F("onHeaderField"),F("onHeaderValue"),F("onPartData"),this.index=p,this.state=d,this.flags=h}end(){if(this.state===U.HEADER_FIELD_START&&this.index===0||this.state===U.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==U.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function ss(n){if(n[K].disturbed)throw new TypeError(`body used already for: ${n.url}`);if(n[K].disturbed=!0,n[K].error)throw n[K].error;let{body:t}=n;if(t===null)return te.Buffer.alloc(0);if(!(t instanceof le.default))return te.Buffer.alloc(0);let r=[],s=0;try{for await(let o of t){if(n.size>0&&s+o.length>n.size){let l=new Q(`content size at ${n.url} over limit: ${n.size}`,"max-size");throw t.destroy(l),l}s+=o.length,r.push(o)}}catch(o){throw o instanceof De?o:new Q(`Invalid response body while trying to fetch ${n.url}: ${o.message}`,"system",o)}if(t.readableEnded===!0||t._readableState.ended===!0)try{return r.every(o=>typeof o=="string")?te.Buffer.from(r.join("")):te.Buffer.concat(r,s)}catch(o){throw new Q(`Could not create Buffer from response body for ${n.url}: ${o.message}`,"system",o)}else throw new Q(`Premature close of server response while trying to fetch ${n.url}`)}var le,qe,te,Fd,K,ve,Wt,Nd,Rn,Ll,Il,Tn=$(()=>{le=V(require("node:stream"),1),qe=require("node:util"),te=require("node:buffer");ar();_n();es();yn();Sn();Fd=(0,qe.promisify)(le.default.pipeline),K=Symbol("Body internals"),ve=class{constructor(t,{size:r=0}={}){let s=null;t===null?t=null:ts(t)?t=te.Buffer.from(t.toString()):ur(t)||te.Buffer.isBuffer(t)||(qe.types.isAnyArrayBuffer(t)?t=te.Buffer.from(t):ArrayBuffer.isView(t)?t=te.Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof le.default||(t instanceof Xe?(t=_l(t),s=t.type.split("=")[1]):t=te.Buffer.from(String(t))));let o=t;te.Buffer.isBuffer(t)?o=le.default.Readable.from(t):ur(t)&&(o=le.default.Readable.from(t.stream())),this[K]={body:t,stream:o,boundary:s,disturbed:!1,error:null},this.size=r,t instanceof le.default&&t.on("error",l=>{let c=l instanceof De?l:new Q(`Invalid response body while trying to fetch ${this.url}: ${l.message}`,"system",l);this[K].error=c})}get body(){return this[K].stream}get bodyUsed(){return this[K].disturbed}async arrayBuffer(){let{buffer:t,byteOffset:r,byteLength:s}=await ss(this);return t.slice(r,r+s)}async formData(){let t=this.headers.get("content-type");if(t.startsWith("application/x-www-form-urlencoded")){let s=new Xe,o=new URLSearchParams(await this.text());for(let[l,c]of o)s.append(l,c);return s}let{toFormData:r}=await Promise.resolve().then(()=>(Wl(),Bl));return r(this.body,t)}async blob(){let t=this.headers&&this.headers.get("content-type")||this[K].body&&this[K].body.type||"",r=await this.arrayBuffer();return new me([r],{type:t})}async json(){let t=await this.text();return JSON.parse(t)}async text(){let t=await ss(this);return new TextDecoder().decode(t)}buffer(){return ss(this)}};ve.prototype.buffer=(0,qe.deprecate)(ve.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(ve.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,qe.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});Wt=(n,t)=>{let r,s,{body:o}=n[K];if(n.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof le.default&&typeof o.getBoundary!="function"&&(r=new le.PassThrough({highWaterMark:t}),s=new le.PassThrough({highWaterMark:t}),o.pipe(r),o.pipe(s),n[K].stream=r,o=s),o},Nd=(0,qe.deprecate)(n=>n.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Rn=(n,t)=>n===null?null:typeof n=="string"?"text/plain;charset=UTF-8":ts(n)?"application/x-www-form-urlencoded;charset=UTF-8":ur(n)?n.type||null:te.Buffer.isBuffer(n)||qe.types.isAnyArrayBuffer(n)||ArrayBuffer.isView(n)?null:n instanceof Xe?`multipart/form-data; boundary=${t[K].boundary}`:n&&typeof n.getBoundary=="function"?`multipart/form-data;boundary=${Nd(n)}`:n instanceof le.default?null:"text/plain;charset=UTF-8",Ll=n=>{let{body:t}=n[K];return t===null?0:ur(t)?t.size:te.Buffer.isBuffer(t)?t.length:t&&typeof t.getLengthSync=="function"&&t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null},Il=async(n,{body:t})=>{t===null?n.end():await Fd(t,n)}});function Dl(n=[]){return new X(n.reduce((t,r,s,o)=>(s%2===0&&t.push(o.slice(s,s+2)),t),[]).filter(([t,r])=>{try{return Cn(t),as(t,String(r)),!0}catch{return!1}}))}var os,fr,Cn,as,X,xn=$(()=>{os=require("node:util"),fr=V(require("node:http"),1),Cn=typeof fr.default.validateHeaderName=="function"?fr.default.validateHeaderName:n=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(n)){let t=new TypeError(`Header name must be a valid HTTP token [${n}]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),t}},as=typeof fr.default.validateHeaderValue=="function"?fr.default.validateHeaderValue:(n,t)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(t)){let r=new TypeError(`Invalid character in header content ["${n}"]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_CHAR"}),r}},X=class n extends URLSearchParams{constructor(t){let r=[];if(t instanceof n){let s=t.raw();for(let[o,l]of Object.entries(s))r.push(...l.map(c=>[o,c]))}else if(t!=null)if(typeof t=="object"&&!os.types.isBoxedPrimitive(t)){let s=t[Symbol.iterator];if(s==null)r.push(...Object.entries(t));else{if(typeof s!="function")throw new TypeError("Header pairs must be iterable");r=[...t].map(o=>{if(typeof o!="object"||os.types.isBoxedPrimitive(o))throw new TypeError("Each header pair must be an iterable object");return[...o]}).map(o=>{if(o.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...o]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return r=r.length>0?r.map(([s,o])=>(Cn(s),as(s,String(o)),[String(s).toLowerCase(),String(o)])):void 0,super(r),new Proxy(this,{get(s,o,l){switch(o){case"append":case"set":return(c,_)=>(Cn(c),as(c,String(_)),URLSearchParams.prototype[o].call(s,String(c).toLowerCase(),String(_)));case"delete":case"has":case"getAll":return c=>(Cn(c),URLSearchParams.prototype[o].call(s,String(c).toLowerCase()));case"keys":return()=>(s.sort(),new Set(URLSearchParams.prototype.keys.call(s)).keys());default:return Reflect.get(s,o,l)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(t){let r=this.getAll(t);if(r.length===0)return null;let s=r.join(", ");return/^content-encoding$/i.test(t)&&(s=s.toLowerCase()),s}forEach(t,r=void 0){for(let s of this.keys())Reflect.apply(t,r,[this.get(s),s,this])}*values(){for(let t of this.keys())yield this.get(t)}*entries(){for(let t of this.keys())yield[t,this.get(t)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((t,r)=>(t[r]=this.getAll(r),t),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((t,r)=>{let s=this.getAll(r);return r==="host"?t[r]=s[0]:t[r]=s.length>1?s:s[0],t},{})}};Object.defineProperties(X.prototype,["get","entries","forEach","values"].reduce((n,t)=>(n[t]={enumerable:!0},n),{}))});var Md,dr,ls=$(()=>{Md=new Set([301,302,303,307,308]),dr=n=>Md.has(n)});var be,re,ql=$(()=>{xn();Tn();ls();be=Symbol("Response internals"),re=class n extends ve{constructor(t=null,r={}){super(t,r);let s=r.status!=null?r.status:200,o=new X(r.headers);if(t!==null&&!o.has("Content-Type")){let l=Rn(t,this);l&&o.append("Content-Type",l)}this[be]={type:"default",url:r.url,status:s,statusText:r.statusText||"",headers:o,counter:r.counter,highWaterMark:r.highWaterMark}}get type(){return this[be].type}get url(){return this[be].url||""}get status(){return this[be].status}get ok(){return this[be].status>=200&&this[be].status<300}get redirected(){return this[be].counter>0}get statusText(){return this[be].statusText}get headers(){return this[be].headers}get highWaterMark(){return this[be].highWaterMark}clone(){return new n(Wt(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(t,r=302){if(!dr(r))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new n(null,{headers:{location:new URL(t).toString()},status:r})}static error(){let t=new n(null,{status:0,statusText:""});return t[be].type="error",t}static json(t=void 0,r={}){let s=JSON.stringify(t);if(s===void 0)throw new TypeError("data is not JSON serializable");let o=new X(r&&r.headers);return o.has("content-type")||o.set("content-type","application/json"),new n(s,{...r,headers:o})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(re.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var Ul,Fl=$(()=>{Ul=n=>{if(n.search)return n.search;let t=n.href.length-1,r=n.hash||(n.href[t]==="#"?"#":"");return n.href[t-r.length]==="?"?"?":""}});function Nl(n,t=!1){return n==null||(n=new URL(n),/^(about|blob|data):$/.test(n.protocol))?"no-referrer":(n.username="",n.password="",n.hash="",t&&(n.pathname="",n.search=""),n)}function zl(n){if(!$l.has(n))throw new TypeError(`Invalid referrerPolicy: ${n}`);return n}function $d(n){if(/^(http|ws)s:$/.test(n.protocol))return!0;let t=n.host.replace(/(^\[)|(]$)/g,""),r=(0,Ml.isIP)(t);return r===4&&/^127\./.test(t)||r===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(t)?!0:n.host==="localhost"||n.host.endsWith(".localhost")?!1:n.protocol==="file:"}function Lt(n){return/^about:(blank|srcdoc)$/.test(n)||n.protocol==="data:"||/^(blob|filesystem):$/.test(n.protocol)?!0:$d(n)}function Vl(n,{referrerURLCallback:t,referrerOriginCallback:r}={}){if(n.referrer==="no-referrer"||n.referrerPolicy==="")return null;let s=n.referrerPolicy;if(n.referrer==="about:client")return"no-referrer";let o=n.referrer,l=Nl(o),c=Nl(o,!0);l.toString().length>4096&&(l=c),t&&(l=t(l)),r&&(c=r(c));let _=new URL(n.url);switch(s){case"no-referrer":return"no-referrer";case"origin":return c;case"unsafe-url":return l;case"strict-origin":return Lt(l)&&!Lt(_)?"no-referrer":c.toString();case"strict-origin-when-cross-origin":return l.origin===_.origin?l:Lt(l)&&!Lt(_)?"no-referrer":c;case"same-origin":return l.origin===_.origin?l:"no-referrer";case"origin-when-cross-origin":return l.origin===_.origin?l:c;case"no-referrer-when-downgrade":return Lt(l)&&!Lt(_)?"no-referrer":l;default:throw new TypeError(`Invalid referrerPolicy: ${s}`)}}function Hl(n){let t=(n.get("referrer-policy")||"").split(/[,\s]+/),r="";for(let s of t)s&&$l.has(s)&&(r=s);return r}var Ml,$l,jl,us=$(()=>{Ml=require("node:net");$l=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),jl="strict-origin-when-cross-origin"});var Gl,Yl,j,hr,jd,et,Ql,Jl=$(()=>{Gl=require("node:url"),Yl=require("node:util");xn();Tn();Sn();Fl();us();j=Symbol("Request internals"),hr=n=>typeof n=="object"&&typeof n[j]=="object",jd=(0,Yl.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),et=class n extends ve{constructor(t,r={}){let s;if(hr(t)?s=new URL(t.url):(s=new URL(t),t={}),s.username!==""||s.password!=="")throw new TypeError(`${s} is an url with embedded credentials.`);let o=r.method||t.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(o)&&(o=o.toUpperCase()),!hr(r)&&"data"in r&&jd(),(r.body!=null||hr(t)&&t.body!==null)&&(o==="GET"||o==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let l=r.body?r.body:hr(t)&&t.body!==null?Wt(t):null;super(l,{size:r.size||t.size||0});let c=new X(r.headers||t.headers||{});if(l!==null&&!c.has("Content-Type")){let d=Rn(l,this);d&&c.set("Content-Type",d)}let _=hr(t)?t.signal:null;if("signal"in r&&(_=r.signal),_!=null&&!yl(_))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let p=r.referrer==null?t.referrer:r.referrer;if(p==="")p="no-referrer";else if(p){let d=new URL(p);p=/^about:(\/\/)?client$/.test(d)?"client":d}else p=void 0;this[j]={method:o,redirect:r.redirect||t.redirect||"follow",headers:c,parsedURL:s,signal:_,referrer:p},this.follow=r.follow===void 0?t.follow===void 0?20:t.follow:r.follow,this.compress=r.compress===void 0?t.compress===void 0?!0:t.compress:r.compress,this.counter=r.counter||t.counter||0,this.agent=r.agent||t.agent,this.highWaterMark=r.highWaterMark||t.highWaterMark||16384,this.insecureHTTPParser=r.insecureHTTPParser||t.insecureHTTPParser||!1,this.referrerPolicy=r.referrerPolicy||t.referrerPolicy||""}get method(){return this[j].method}get url(){return(0,Gl.format)(this[j].parsedURL)}get headers(){return this[j].headers}get redirect(){return this[j].redirect}get signal(){return this[j].signal}get referrer(){if(this[j].referrer==="no-referrer")return"";if(this[j].referrer==="client")return"about:client";if(this[j].referrer)return this[j].referrer.toString()}get referrerPolicy(){return this[j].referrerPolicy}set referrerPolicy(t){this[j].referrerPolicy=zl(t)}clone(){return new n(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(et.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});Ql=n=>{let{parsedURL:t}=n[j],r=new X(n[j].headers);r.has("Accept")||r.set("Accept","*/*");let s=null;if(n.body===null&&/^(post|put)$/i.test(n.method)&&(s="0"),n.body!==null){let _=Ll(n);typeof _=="number"&&!Number.isNaN(_)&&(s=String(_))}s&&r.set("Content-Length",s),n.referrerPolicy===""&&(n.referrerPolicy=jl),n.referrer&&n.referrer!=="no-referrer"?n[j].referrer=Vl(n):n[j].referrer="no-referrer",n[j].referrer instanceof URL&&r.set("Referer",n.referrer),r.has("User-Agent")||r.set("User-Agent","node-fetch"),n.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip, deflate, br");let{agent:o}=n;typeof o=="function"&&(o=o(t));let l=Ul(t),c={path:t.pathname+l,method:n.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:n.insecureHTTPParser,agent:o};return{parsedURL:t,options:c}}});var pr,Kl=$(()=>{yn();pr=class extends De{constructor(t,r="aborted"){super(t,r)}}});var eu={};pi(eu,{AbortError:()=>pr,Blob:()=>me,FetchError:()=>Q,File:()=>Ke,FormData:()=>Xe,Headers:()=>X,Request:()=>et,Response:()=>re,blobFrom:()=>Cl,blobFromSync:()=>Tl,default:()=>cs,fileFrom:()=>xl,fileFromSync:()=>kl,isRedirect:()=>dr});async function cs(n,t){return new Promise((r,s)=>{let o=new et(n,t),{parsedURL:l,options:c}=Ql(o);if(!zd.has(l.protocol))throw new TypeError(`node-fetch cannot load ${n}. URL scheme "${l.protocol.replace(/:$/,"")}" is not supported.`);if(l.protocol==="data:"){let y=ll(o.url),w=new re(y,{headers:{"Content-Type":y.typeFull}});r(w);return}let _=(l.protocol==="https:"?Zl.default:Xl.default).request,{signal:p}=o,d=null,h=()=>{let y=new pr("The operation was aborted.");s(y),o.body&&o.body instanceof ne.default.Readable&&o.body.destroy(y),!(!d||!d.body)&&d.body.emit("error",y)};if(p&&p.aborted){h();return}let g=()=>{h(),P()},v=_(l.toString(),c);p&&p.addEventListener("abort",g);let P=()=>{v.abort(),p&&p.removeEventListener("abort",g)};v.on("error",y=>{s(new Q(`request to ${o.url} failed, reason: ${y.message}`,"system",y)),P()}),Vd(v,y=>{d&&d.body&&d.body.destroy(y)}),process.version<"v14"&&v.on("socket",y=>{let w;y.prependListener("end",()=>{w=y._eventsCount}),y.prependListener("close",T=>{if(d&&w<y._eventsCount&&!T){let k=new Error("Premature close");k.code="ERR_STREAM_PREMATURE_CLOSE",d.body.emit("error",k)}})}),v.on("response",y=>{v.setTimeout(0);let w=Dl(y.rawHeaders);if(dr(y.statusCode)){let O=w.get("Location"),W=null;try{W=O===null?null:new URL(O,o.url)}catch{if(o.redirect!=="manual"){s(new Q(`uri requested responds with an invalid redirect URL: ${O}`,"invalid-redirect")),P();return}}switch(o.redirect){case"error":s(new Q(`uri requested responds with a redirect, redirect mode is set to error: ${o.url}`,"no-redirect")),P();return;case"manual":break;case"follow":{if(W===null)break;if(o.counter>=o.follow){s(new Q(`maximum redirect reached at: ${o.url}`,"max-redirect")),P();return}let I={headers:new X(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:Wt(o),signal:o.signal,size:o.size,referrer:o.referrer,referrerPolicy:o.referrerPolicy};if(!gl(o.url,W)||!Sl(o.url,W))for(let Ee of["authorization","www-authenticate","cookie","cookie2"])I.headers.delete(Ee);if(y.statusCode!==303&&o.body&&t.body instanceof ne.default.Readable){s(new Q("Cannot follow redirect with body being a readable stream","unsupported-redirect")),P();return}(y.statusCode===303||(y.statusCode===301||y.statusCode===302)&&o.method==="POST")&&(I.method="GET",I.body=void 0,I.headers.delete("content-length"));let ue=Hl(w);ue&&(I.referrerPolicy=ue),r(cs(new et(W,I))),P();return}default:return s(new TypeError(`Redirect option '${o.redirect}' is not a valid value of RequestRedirect`))}}p&&y.once("end",()=>{p.removeEventListener("abort",g)});let T=(0,ne.pipeline)(y,new ne.PassThrough,O=>{O&&s(O)});process.version<"v12.10"&&y.on("aborted",g);let k={url:o.url,status:y.statusCode,statusText:y.statusMessage,headers:w,size:o.size,counter:o.counter,highWaterMark:o.highWaterMark},L=w.get("Content-Encoding");if(!o.compress||o.method==="HEAD"||L===null||y.statusCode===204||y.statusCode===304){d=new re(T,k),r(d);return}let F={flush:bt.default.Z_SYNC_FLUSH,finishFlush:bt.default.Z_SYNC_FLUSH};if(L==="gzip"||L==="x-gzip"){T=(0,ne.pipeline)(T,bt.default.createGunzip(F),O=>{O&&s(O)}),d=new re(T,k),r(d);return}if(L==="deflate"||L==="x-deflate"){let O=(0,ne.pipeline)(y,new ne.PassThrough,W=>{W&&s(W)});O.once("data",W=>{(W[0]&15)===8?T=(0,ne.pipeline)(T,bt.default.createInflate(),I=>{I&&s(I)}):T=(0,ne.pipeline)(T,bt.default.createInflateRaw(),I=>{I&&s(I)}),d=new re(T,k),r(d)}),O.once("end",()=>{d||(d=new re(T,k),r(d))});return}if(L==="br"){T=(0,ne.pipeline)(T,bt.default.createBrotliDecompress(),O=>{O&&s(O)}),d=new re(T,k),r(d);return}d=new re(T,k),r(d)}),Il(v,o).catch(s)})}function Vd(n,t){let r=mr.Buffer.from(`0\r
\r
`),s=!1,o=!1,l;n.on("response",c=>{let{headers:_}=c;s=_["transfer-encoding"]==="chunked"&&!_["content-length"]}),n.on("socket",c=>{let _=()=>{if(s&&!o){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",t(d)}},p=d=>{o=mr.Buffer.compare(d.slice(-5),r)===0,!o&&l&&(o=mr.Buffer.compare(l.slice(-3),r.slice(0,3))===0&&mr.Buffer.compare(d.slice(-2),r.slice(3))===0),l=d};c.prependListener("close",_),c.on("data",p),n.on("close",()=>{c.removeListener("close",_),c.removeListener("data",p)})})}var Xl,Zl,bt,ne,mr,zd,tu=$(()=>{Xl=V(require("node:http"),1),Zl=V(require("node:https"),1),bt=V(require("node:zlib"),1),ne=V(require("node:stream"),1),mr=require("node:buffer");ul();Tn();ql();xn();Jl();es();Kl();ls();_n();Sn();us();ns();zd=new Set(["data:","http:","https:"])});var Yd={};pi(Yd,{activate:()=>Hd,deactivate:()=>Gd});module.exports=Kc(Yd);var Lo=V(require("vscode"));var he=require("vscode");var Ao=require("vscode");function Gr(n,t,r){return n.asWebviewUri(Ao.Uri.joinPath(t,...r))}function Oo(){let n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<32;r++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}var Y=class n{constructor(t,r){this.extensionUris=[];this.disposables=[];n.context?(this.extensionUri=n.context.extensionUri,this.extensionUris=[he.Uri.joinPath(n.context.extensionUri,"out"),he.Uri.joinPath(n.context.extensionUri,"webview-ui/build"),he.Uri.joinPath(n.context.extensionUri,"assets"),he.Uri.joinPath(n.context.extensionUri,"webview-ui/node_modules/@vscode/codicons/dist")]):(console.log("Error: BaseWebview.constructor called before activate()"),this.extensionUri=he.Uri.parse("file:///undefined")),this.key=t,this.title=r,n.instances[t]=this}static{this.instances={}}static setBackendSyncMessageCallback(t){n.backendSyncMessageCallback=t}getWebview(){return this.panel?this.panel.webview:this.webview}getPanel(){return this.panel}getKey(){return this.key}getTitle(){return this.title}static activate(t){n.context=t,n.backendSyncMessageCallback=r=>{console.error(`BaseWebview.backendSyncMessageCallback() called before set for message: ${JSON.stringify(r)}`)}}static deactivate(){console.log("Webview Deactivate called");for(let t in n.instances){let r=n.instances[t];r.panel=void 0,r.webview=void 0}n.instances={},n.context=void 0}resolveWebviewView(t,r,s){this.webview=t.webview,t.webview.options={enableScripts:!0,localResourceRoots:this.extensionUris},t.webview.html=this._getWebviewContent(),t.webview.onDidReceiveMessage(o=>{this.handleMessage(o),n.backendSyncMessageCallback?.(o)},void 0,this.disposables)}renderPanel(){this.panel!==void 0?(this.panel.reveal(he.ViewColumn.One),console.log("BaseWebview render_panel reveal() called")):(console.log("BaseWebview render_panel called"),this.panel=he.window.createWebviewPanel(this.key,this.title,he.ViewColumn.One,{enableScripts:!0,localResourceRoots:this.extensionUris,retainContextWhenHidden:!0}),this.panel.onDidDispose(()=>this.dispose(),null,this.disposables),this.panel.webview.html=this._getWebviewContent(),this.panel.webview.onDidReceiveMessage(t=>{this.handleMessage(t),n.backendSyncMessageCallback?.(t)},void 0,this.disposables))}dispose(){for(this.panel&&(this.panel.dispose(),this.panel=void 0),this.webview&&(this.webview=void 0);this.disposables.length;){let t=this.disposables.pop();t&&t.dispose()}}_getWebviewContent(){let t=this.getWebview();if(!t)return"Error: Missing webview instance";let r=Gr(t,this.extensionUri,["webview-ui","build","assets","index.css"]),s=Gr(t,this.extensionUri,["webview-ui","build","assets","index.js"]),o=Gr(t,this.extensionUri,["webview-ui","node_modules","@vscode/codicons","dist","codicon.css"]),l=Oo(),c=t.cspSource;return`
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <title>Webview-UI</title>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0" />
          <meta http-equiv="Content-Security-Policy" content="default-src ${c}; connect-src http://localhost:*; font-src ${c} 'self' https://fonts.gstatic.com data:; style-src 'self' https://fonts.googleapis.com ${c} 'unsafe-inline'; img-src ${c}; script-src ${c} 'strict-dynamic' 'nonce-${l}'">
          
          <link rel="stylesheet" type="text/css" href="${r}">
          <link rel="stylesheet" type="text/css" href="${o}" />
        </head>
        <body>
          <script nonce="${l}">
            var suibase_view_key = '${this.key}';
          </script>
          <div id="root"></div>
          <script type="module" nonce="${l}" src="${s}"></script>
        </body>
      </html>
    `}handleMessage(t){}postMessage(t){if(n.context===void 0){console.log("Warning: postMessage() called on deactivated view");return}this.panel?this.panel.webview.postMessage(t):this.webview&&this.webview.postMessage(t)}static broadcastMessage(t){for(let r in n.instances)n.instances[r].postMessage(t)}static postMessageTo(t,r){let s=n.instances[t];s&&s.postMessage(r)}};var mi=class{constructor(){this.loaded=!1;this.uiSelectedContext="DSUI";this.uiSelectedContextCallback=t=>{}}serialize(){return JSON.stringify(this,(t,r)=>{if(t!=="uiSelectedContextCallback")return r})}deserialize(t){let r=JSON.parse(t),s=!1;r.uiSelectedContextCallback!==this.uiSelectedContextCallback&&(s=!0),Object.assign(this,r),s&&this.uiSelectedContextCallback(this.uiSelectedContext)}},Pt=class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}constructor(){this.globalStates=new mi}static activate(){if(console.log("SuibaseData.activateForExtension() called"),n.instance){console.log("Error: SuibaseData.activate() called more than once");return}n.getInstance()}static deactivate(){n.instance?(delete n.instance,n.instance=void 0):console.log("Error: SuibaseData.deactivate() called out of order")}};var ut=["mainnet","testnet","devnet","localnet"];var Bo="http://0.0.0.0:44399",Yr="suibase.settings",Qr="suibase.console",Wo="suibase.sidebar",bi="suibase.backend";var Ht=class n extends Y{constructor(){super(Wo,"Sui Sidebar")}static activate(t){if(console.log("SuibaseSidebar.activate() called"),n.instance){console.log("Error: SuibaseSidebar.activate() called more than once");return}n.instance=new n;let r=Lo.window.registerWebviewViewProvider("explorerView",n.instance,{webviewOptions:{retainContextWhenHidden:!0}});t.subscriptions.push(r)}static deactivate(){n.instance?(n.instance.dispose(),delete n.instance,n.instance=void 0):console.log("Error: SuibaseSidebar.deactivate() called out of order")}dispose(){console.log("SuibaseSidebar.dispose() called"),n.instance?(super.dispose(),delete n.instance,n.instance=void 0):console.log("Error: dispose() called out of order")}handleMessage(t){let r=Pt.getInstance();switch(t.type){case"init-view":super.postMessage({type:"init-global-states",message:r.globalStates.serialize()});break}}};var ol=V(require("child_process"));var _d=V(Uo(),1),yd=V(qi(),1),gd=V(Fi(),1),il=V(Hi(),1),Sd=V(nl(),1);var sl=il.default;var Yi=n=>new Promise((t,r)=>{ol.exec(n,(s,o)=>s?r(s):t(o))}),nr=class n{constructor(){this.cache={};this.ws=new sl("ws://localhost:44399"),this.ws.on("open",()=>{console.log("WebSocket connection opened")}),this.ws.on("close",()=>{console.log("WebSocket connection closed")}),this.ws.on("message",t=>{let r=JSON.parse(t);this.cache.response=r.result,console.log(r.result)})}dispose(){this.ws&&(this.ws.close(),delete this.ws,this.ws=void 0)}static activate(t){if(n.context){console.log("Error: SuibaseExec.activate() called more than once");return}n.context=t,n.instance=new n}static deactivate(){n.instance?(n.instance.dispose(),delete n.instance,n.instance=void 0):console.log("Error: SuibaseExec.deactivate() called out of order"),n.context=void 0}static getInstance(){return n.instance||console.log("Error: SuibaseExec.getInstance() called before activate()"),n.instance}async version(){try{let t=await Yi("localnet --version");return console.log(t),Promise.resolve(t)}catch(t){return Promise.reject(t)}}async startDaemon(){let t=!1;try{let s=(await Yi("lsof /tmp/.suibase/suibase-daemon.lock")).split(`
`);for(let o=0;o<s.length&&!t;o++)s[o].split(" ")[0].indexOf("suibase")===0&&(t=!0)}catch{}if(!t){let r=await Yi("~/suibase/scripts/common/run-daemon.sh suibase &");await new Promise(s=>setTimeout(s,500))}}makeJsonRpcCall(){let t=n.getInstance();if(t&&t.ws){let r={jsonrpc:"2.0",method:"getLinks",params:{workdir:"localnet"},id:1};t.ws.send(JSON.stringify(r))}}async getLinks(){try{return this.makeJsonRpcCall(),Promise.resolve("sent")}catch(t){return Promise.reject(t)}}};var ir=V(require("vscode"));var un=class n extends Y{constructor(){super(Yr,"Suibase Dashboard")}static render(){n.instance||(n.instance=new n),n.instance.renderPanel()}dispose(){n.instance?(super.dispose(),delete n.instance,n.instance=void 0):console.log("Error: dispose() called out of order")}handleMessage(t){}};var cn=class n extends Y{constructor(){super(Qr,"Sui Console")}static render(){n.instance||(n.instance=new n),n.instance.renderPanel()}dispose(){console.log("ConsolePanel.dispose() called"),n.instance?(super.dispose(),delete n.instance,n.instance=void 0):console.log("Error: dispose() called out of order")}};var sr=class n{constructor(){}dispose(){}static activate(t){if(n.instance){console.error("SuibaseCommands.activate() called more than once");return}n.context=t,n.instance=new n;{let r=ir.commands.registerCommand(Yr,()=>{n.getInstance()?.settings()});t.subscriptions.push(r)}{let r=ir.commands.registerCommand(Qr,()=>{n.getInstance()?.console()});t.subscriptions.push(r)}{let r=ir.commands.registerCommand("suibase.refresh",()=>{n.getInstance()?.refresh()});t.subscriptions.push(r)}setInterval(()=>{ir.commands.executeCommand("suibase.refresh")},3e3)}static deactivate(){n.instance?(n.instance.dispose(),delete n.instance,n.instance=void 0):console.log("Error: SuibaseCommands.deactivate() called out of order"),n.context=void 0}static getInstance(){if(!n.instance){console.log("Error: SuibaseCommands.getInstance() called before activate()");return}return n.instance}refresh(t){}settings(){n.context&&un.render()}console(){n.context&&cn.render()}};var Gh=new Error("timeout while waiting for mutex to become available"),Yh=new Error("mutex already locked"),wd=new Error("request for lock canceled"),vd=function(n,t,r,s){function o(l){return l instanceof r?l:new r(function(c){c(l)})}return new(r||(r=Promise))(function(l,c){function _(h){try{d(s.next(h))}catch(g){c(g)}}function p(h){try{d(s.throw(h))}catch(g){c(g)}}function d(h){h.done?l(h.value):o(h.value).then(_,p)}d((s=s.apply(n,t||[])).next())})},Qi=class{constructor(t,r=wd){this._value=t,this._cancelError=r,this._queue=[],this._weightedWaiters=[]}acquire(t=1,r=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,o)=>{let l={resolve:s,reject:o,weight:t,priority:r},c=al(this._queue,_=>r<=_.priority);c===-1&&t<=this._value?this._dispatchItem(l):this._queue.splice(c+1,0,l)})}runExclusive(t){return vd(this,arguments,void 0,function*(r,s=1,o=0){let[l,c]=yield this.acquire(s,o);try{return yield r(l)}finally{c()}})}waitForUnlock(t=1,r=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,r)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),Ed(this._weightedWaiters[t-1],{resolve:s,priority:r})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){let r=this._value;this._value-=t.weight,t.resolve([r,this._newReleaser(t.weight)])}_newReleaser(t){let r=!1;return()=>{r||(r=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){let r=this._weightedWaiters[t-1];r&&(r.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{let t=this._queue[0].priority;for(let r=this._value;r>0;r--){let s=this._weightedWaiters[r-1];if(!s)continue;let o=s.findIndex(l=>l.priority<=t);(o===-1?s:s.splice(0,o)).forEach(l=>l.resolve())}}}_couldLockImmediately(t,r){return(this._queue.length===0||this._queue[0].priority<r)&&t<=this._value}};function Ed(n,t){let r=al(n,s=>t.priority<=s.priority);n.splice(r+1,0,t)}function al(n,t){for(let r=n.length-1;r>=0;r--)if(t(n[r]))return r;return-1}var Rd=function(n,t,r,s){function o(l){return l instanceof r?l:new r(function(c){c(l)})}return new(r||(r=Promise))(function(l,c){function _(h){try{d(s.next(h))}catch(g){c(g)}}function p(h){try{d(s.throw(h))}catch(g){c(g)}}function d(h){h.done?l(h.value):o(h.value).then(_,p)}d((s=s.apply(n,t||[])).next())})},fn=class{constructor(t){this._semaphore=new Qi(1,t)}acquire(){return Rd(this,arguments,void 0,function*(t=0){let[,r]=yield this._semaphore.acquire(1,t);return r})}runExclusive(t,r=0){return this._semaphore.runExclusive(()=>t(),1,r)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};var dn=class{constructor(t,r){this.name=t,this.sender=r}},hn=class extends dn{constructor(t,r,s){super("UpdateVersions",t),this.workdirIdx=r,this.json=s}},pn=class extends dn{constructor(t,r,s){super("UpdateWorkdirStatus",t),this.workdirIdx=r,this.json=s}};var or=class{constructor(){this.method="",this.methodUuid="",this.dataUuid="",this.json=null}getMethod(){return this.method}getMethodUuid(){return this.methodUuid}getDataUuid(){return this.dataUuid}getJson(){return this.json}update(t){let r=t.header.method,s=t.header.methodUuid,o=t.header.dataUuid;return this.method!==""&&r!==this.method?(console.error(`Trying to update [${this.json.method}] using a JSON from [${r}]`),!1):this.json===null||this.methodUuid!==s||o>this.dataUuid?(this.method=r,this.methodUuid=s,this.dataUuid=o,this.json=t,this.deltaDetected(),!0):!1}deltaDetected(){}},mn=class extends or{isWorkdirStatusUpdateNeeded(t){try{let r=t===null||t.getJson()===null||t.getMethod()===""||t.getMethodUuid()===""||t.getDataUuid()==="";for(let s of this.getJson().versions)if(s.method==="getWorkdirStatus"){let o=s.methodUuid,l=s.dataUuid;if(r||t.getMethodUuid()!==o||t.getDataUuid()<l)return[!0,o,l];break}}catch(r){console.error(`Problem comparing versions for SuibaseJsonWorkdirStatus ${JSON.stringify(t)} and versions ${JSON.stringify(this.getJson())}: error [${r}]`)}return[!1,"",""]}deltaDetected(){super.deltaDetected()}};var fs=class{constructor(){this.versions=new mn,this.workdirStatus=new or}},kn=class n{constructor(){this.mWorkdirTrackings=[];this.loopMutex=new fn;this.mWorkdir="";for(let t=0;t<ut.length;t++)this.mWorkdirTrackings.push(new fs)}static activate(){n.sInstance?console.error("BackendSync.activate() called more than once"):n.getInstance()}static deactivate(){let t=n.sInstance;t&&(t.mWorkdirTrackings=[]),n.sInstance=void 0}static getInstance(){return n.sInstance||(n.sInstance=new n,Y.setBackendSyncMessageCallback(n.sInstance.handleViewMessage.bind(n.sInstance)),setTimeout(()=>{n.sInstance&&n.sInstance.syncLoop()},1)),n.sInstance}get workdir(){return this.mWorkdir}handleViewMessage(t){try{if(t.name==="ForceVersionsRefresh"||t.name==="InitView")this.forceRefresh();else if(t.name==="WorkdirCommand"){let r="";t.workdirIdx>=0&&t.workdirIdx<ut.length&&(r=ut[t.workdirIdx]),this.fetchWorkdirCommand(r,t.command)}else t.name==="RequestWorkdirStatus"&&this.replyWorkdirStatus(t)}catch(r){console.error(`Error in handleViewMessage: ${r}`)}}forceRefresh(){this.syncLoop(!0)}syncLoop(t=!1){this.asyncLoop(t).catch(r=>console.log(r))}async asyncLoop(t){await this.loopMutex.runExclusive(async()=>{this.update(t),t===!1&&setTimeout(()=>{this.syncLoop(t)},1e3)})}async fetchBackend(t,r={}){let s={"Content-Type":"application/json"},o={id:1,jsonrpc:"2.0",method:t,params:r};try{let c=await(await Promise.resolve().then(()=>(tu(),eu)).then(p=>p.default))(Bo,{method:"POST",headers:s,body:JSON.stringify(o)});if(!c.ok)throw new Error(`${t} ${r} not ok`);let _=await c.json();return n.validateHeader(_,t),_}catch(l){let c=`Error in fetchBackend ${t} ${r}: ${l}`;throw console.error(c),l}}async fetchGetVersions(t){return await this.fetchBackend("getVersions",{workdir:t})}async fetchGetWorkdirStatus(t){return await this.fetchBackend("getWorkdirStatus",{workdir:t})}async fetchWorkdirCommand(t,r){return await this.fetchBackend("workdirCommand",{workdir:t,command:r})}static validateHeader(t,r){if(t.jsonrpc!=="2.0")throw new Error("Invalid JSON-RPC version");if(t.result.header.method!==r)throw new Error("Invalid method")}async update(t){try{await this.updateUsingBackend(t)}catch{}}async updateUsingBackend(t){for(let r=0;r<ut.length;r++){let s=ut[r],o=await this.fetchGetVersions(s);if(o)try{(this.mWorkdirTrackings[r].versions.update(o.result)||t)&&Y.broadcastMessage(new hn(bi,r,o.result))}catch(l){let c=`Error in updateUsingBackend: ${l}. Data: ${JSON.stringify(o)}`;throw console.error(c),new Error(c)}}}async replyWorkdirStatus(t){let r=t.sender,s=t.workdirIdx,o=t.methodUuid,l=t.dataUuid,c=null;try{let _=ut[s],p=this.mWorkdirTrackings[s],d=p.workdirStatus;c=d.getJson(),(!c||o!==d.getMethodUuid()||l!==d.getDataUuid())&&(c=(await this.fetchGetWorkdirStatus(_)).result,p.workdirStatus.update(c)),Y.postMessageTo(r,new pn(bi,s,c))}catch(_){let p=`Error in replyWorkdirStatus: ${_}. Data: ${JSON.stringify(c)}`;console.error(p)}}};function Hd(n){Pt.activate(),nr.activate(n),Y.activate(n),kn.activate(),sr.activate(n),Ht.activate(n),console.log("extension activate() completed")}function Gd(){Ht.deactivate(),sr.deactivate(),Y.deactivate(),nr.deactivate(),console.log("extension deactivate() completed")}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)
*/
